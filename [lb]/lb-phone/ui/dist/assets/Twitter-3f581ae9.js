import{r as i,a3 as Ne,j as a,a as e,ch as M,d as V,L as s,t as N,v as F,w as G,C as D,u as Z,H as j,N as z,a2 as Q,X as ne,ad as ee,a6 as K,a7 as J,F as b,q as fe,ci as Se,b as $,cj as Ie,al as Pe,ck as Ae,aF as ie,b$ as Re,cl as Ce,K as We,Q as pe,m as Ee,W as Oe,a8 as _e,bW as Le,cm as be,bD as ke,cn as ye,aO as ve,co as De,cp as Ue,cq as ge,cr as ae,ao as Fe,ap as xe,bI as Be,cs as Me,af as qe,aR as He,ct as Ge,cu as $e,a9 as Ve,aX as we,ac as je,b0 as Ye,ay as ze,P as Je,A as Ke}from"./index-eaa656b5.js";import{T as re}from"./Textarea-998d5eb2.js";import{S as Xe}from"./Switch-c45ef118.js";const U={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,date_joined:162e10},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,date_joined:162e10,followers:13,following:2},breze:{username:"breze",name:"Breze",bio:"Developer @lb",verified:!1,date_joined:162e10,followers:0,following:0},loaf:{username:"loaf",name:"Loaf Scripts",bio:"Developer @lb",verified:!1,date_joined:162e10,followers:0,following:0}},tweets:[{user:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0},tweet:{id:"2",content:"LB Phone 2.0 is now released! Check it out at https://lbscripts.com",attachments:[],date_created:Date.now()-1e3*60*60*2,retweets:0,replies:1,likes:4,liked:!1,retweeted:!1,_replies:[{user:{username:"breze",name:"Breze"},tweet:{id:"4",content:"finally, been waiting for this for ages!",attachments:[],date_created:Date.now()-1e3*60*60*1,retweets:0,replies:0,likes:0,liked:!1,retweeted:!1}}]}},{user:{username:"breze",name:"Breze"},tweet:{id:"3",content:"wow, the birdy app really is cool",attachments:[],date_created:Date.now()-1e3*60*60*3,retweets:0,replies:0,likes:1,liked:!0,retweeted:!1}},{user:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0},tweet:{id:"1",content:"Hello, world!",attachments:[],date_created:Date.now()-1e3*60*60*5,retweets:0,replies:0,likes:0,liked:!1,retweeted:!1}}],notifications:[{type:"reply",username:"breze",name:"Breze",tweet_id:"2",content:"finally, been waiting for this for ages!",retweet_count:0,reply_count:0,like_count:0,timestamp:Date.now()-1e3*60*60*2},{type:"like",username:"loaf",name:"Loaf Scripts",tweet_id:"2",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3},{type:"follow",username:"breze",name:"Breze",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}],messages:[{username:"breze",name:"Breze",content:"great job on the new update, really proud of you!",timestamp:Date.now()-1e3*60*60*4,messages:[{sender:"breze",name:"Breze",content:"great job on the new update, really proud of you!",attachments:[],timestamp:Date.now()-1e3*60*60*4}]},{username:"loaf",name:"Loaf Scripts",content:"thanks for responding, haha!",timestamp:Date.now()-1e3*60*60*24,messages:[{sender:"loaf",name:"Loaf Scripts",content:"thanks for responding, give me 5 mins..",attachments:[],timestamp:Date.now()-1e3*60*60*24},{sender:"lb",name:"LB",content:"no problem, happy to help!",attachments:[],timestamp:Date.now()-1e3*60*60*24+1e3},{sender:"loaf",name:"Loaf Scripts",content:"Hey LB, I have a question about the new update, can you help me?",attachments:[],timestamp:Date.now()-1e3*60*60*24+2e3}]}]};function te(n){const{Func:c,User:v}=i.useContext(q),[r,m]=v;c.Profile;const[t,T]=c.LoggedIn,[f,g]=c.View,[R,o]=c.Timeline,k=()=>{N("AccountSwitcher",{action:"getAccounts",app:"Twitter"},null).then(w=>{var l;if(!w)return F("info","No accounts found");let d=r.isAdmin,A=(l=w==null?void 0:w.filter(S=>S!==r.username))==null?void 0:l.map(S=>({title:S,cb:()=>{N("AccountSwitcher",{action:"switch",app:"Twitter",account:S}).then(()=>{N("Twitter",{action:"isLoggedIn"}).then(_=>{_?(G.APPS.TWITTER.account.set(_),m({..._,isAdmin:d}),g("timeline")):G.APPS.TWITTER.account.set(!1)})})}}));D.ContextMenu.set({buttons:[{title:r.username},...A,{title:s("APPS.TWITTER.ADD_ACCOUNT"),cb:()=>{T(!1)}}]})})},h=Ne(()=>k(),{delay:250});return a("div",{className:"twitter-header",children:[a("div",{className:"twitter-header-top",children:[e("div",{...h,onClick:()=>c.fetchAndSetProfile(r.username),children:e(M,{className:"profile-picture",avatar:r.profile_picture})}),n.search?e("div",{className:"search-container",children:e(V,{type:"text",placeholder:n.placeholder??s("APPS.TWITTER.SEARCH_TWITTER"),onChange:w=>n.search(w.target.value)})}):n.notifications?e("div",{className:"title",children:s("APPS.TWITTER.NOTIFICATIONS")}):e("div",{className:"logo",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),f=="timeline"&&e("div",{className:"twitter-header-bottom",children:a("div",{className:"options",children:[e("div",{className:`option ${R==="default"?"active":""}`,onClick:()=>o("default"),children:s("APPS.TWITTER.ALL")}),e("div",{className:`option ${R==="following"?"active":""}`,onClick:()=>o("following"),children:s("APPS.TWITTER.FOLLOWING")})]})})]})}function Qe(n){const{Func:c,User:v}=i.useContext(q),r=Z($),[m]=v,t=n.data,[T,f]=i.useState([]),g=i.useRef(null),R=i.useRef(0),[o,k]=i.useState({content:"",attachments:[]});i.useEffect(()=>{var d,A;j("Twitter")&&(f([]),N("Twitter",{action:"getMessages",data:{username:t.username,page:0}},(A=(d=U==null?void 0:U.messages)==null?void 0:d.find(l=>l.username===t.username))==null?void 0:A.messages).then(l=>{l&&f(l.reverse())}))},[]);const{handleScroll:h}=z({fetchData:d=>N("Twitter",{action:"getMessages",data:{username:t.username,page:d}}),onDataFetched:d=>{let A=document.querySelector(".dm-message-container");R.current=A.scrollHeight,f([...d.reverse(),...T])},isReversed:!0,perPage:25});i.useEffect(()=>{let d=document.querySelector(".dm-message-container");const A=d.scrollHeight;d.scrollTop+=A-R.current,d.scroll},[T]);const w=()=>{if(o.content.length<=0&&o.attachments.length<=0)return;const d={sender:m.username,recipient:t.username,content:o.content,attachments:o.attachments,timestamp:new Date().getTime()};N("Twitter",{action:"sendMessage",data:d},!0).then(A=>{if(!A)return F("error","Failed to send message");g.current.value="",k({content:"",attachments:[]}),f([...T,d])})};return Q("twitter:newMessage",d=>{t.username===d.sender&&f([...T,d])}),a("div",{className:"slide left",children:[a("div",{className:"dm-header",children:[e("i",{className:"fal fa-arrow-left",onClick:()=>n.goBack()}),a("div",{className:"user",onClick:()=>c.fetchAndSetProfile(t.username),children:[e("div",{className:"profile-picture",children:e(M,{avatar:t.profile_picture})}),a("div",{className:"name",children:[t.name,t.verified&&e("i",{className:"fas fa-badge-check verified"})]})]}),e("span",{})]}),e("div",{className:"dm-message-container",onScroll:h,children:e("div",{className:"message-body",children:T.map((d,A)=>{var O;let l,S=d.sender===m.username?"self":"other",_=((O=T[A+1])==null?void 0:O.sender)===m.username?"self":"other";if(T[A+1]?l=Math.abs(d.timestamp-T[A+1].timestamp)/36e5:_=void 0,d.content.includes(".gif")){let u=d.content,W=u.split(" ").find(P=>P.includes(".gif"));d.content=u.replace(W,""),d.attachments.push(W)}return a("div",{className:ne("message",S),children:[S=="other"?a("div",{className:"tweet-with-pfp",children:[e("div",{className:`profile-picture ${S!==_?"show":"hide"}`,children:e(M,{avatar:t.profile_picture})}),a("div",{className:"tweet-content",children:[d.content&&e("div",{className:"content",children:ee(d.content,!0)}),d.attachments.length>0&&e("div",{className:"attatchments",children:d.attachments.map((u,W)=>K(u)?e("video",{src:u,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:()=>{D.FullscreenImage.set(u)}},W):e(J,{src:u,blur:!0,onClick:()=>{D.FullscreenImage.set(u)}},W))})]})]}):a(b,{children:[d.content&&e("div",{className:"content",children:ee(d.content)}),d.attachments.length>0&&e("div",{className:"attatchments",children:d.attachments.map((u,W)=>K(u)?e("video",{src:u,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:()=>u},W):e(J,{src:u,onClick:()=>{D.FullscreenImage.set(u)}},W))})]}),T[A+1]&&l>6?e("div",{className:"date",children:fe(d.timestamp)}):S!==_&&e("div",{className:"date",children:fe(d.timestamp)})]},A)})})}),e("div",{className:"attachments",children:o.attachments.map((d,A)=>a("div",{className:"attachment",children:[K(d)?e("video",{src:d,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(J,{src:d}),e("i",{className:"fal fa-times",onClick:()=>{k({...o,attachments:o.attachments.filter((l,S)=>S!==A)})}})]}))}),a("div",{className:"message-bottom",children:[e(Se,{onClick:()=>{var d,A,l;o.attachments.length<2&&D.Gallery.set({includeVideos:!0,allowExternal:(l=(A=(d=$)==null?void 0:d.value)==null?void 0:A.AllowExternal)==null?void 0:l.Birdy,onSelect:S=>k({...o,attachments:[...o.attachments,S.src]})})}}),r.EnableGIFs!==!1&&e("div",{className:"gif",onClick:()=>{D.Gif.set({onSelect:d=>k({...o,content:o.content.length>0?o.content+" "+d:d})})},children:"GIF"}),e(re,{placeholder:s("APPS.TWITTER.MESSAGE_PLACEHOLDER"),rows:3,value:o.content,onChange:d=>k({...o,content:d.target.value}),onKeyDown:d=>{d.key==="Enter"&&w()},ref:g}),e(Ie,{className:"send",onClick:w})]})]})}function Ze(){const{Func:n,User:c}=i.useContext(q),[v]=c,[r,m]=i.useState(""),[t,T]=i.useState(""),[f,g]=i.useState([]),[R,o]=i.useState([]),[k,h]=i.useState(!1),[w,d]=n.DmUser;i.useEffect(()=>{j("Twitter")&&N("Twitter",{action:"getRecentMessages",page:0},U.messages).then(l=>{if(!l)return F("error","Failed to fetch recent messages");o(l.filter(S=>S.username!==v.username))})},[]),i.useEffect(()=>{const l=setTimeout(()=>m(t),500);return()=>clearTimeout(l)},[t]),i.useEffect(()=>{r.length>0?k?N("Twitter",{action:"searchAccounts",query:r},Object.keys(U.accounts).filter(l=>l==null?void 0:l.toLowerCase().includes(r==null?void 0:r.toLowerCase()))).then(l=>{l&&g(l.filter(S=>S.username!==v.username))}):g(R.filter(l=>(l.username.includes(r)||l.name.includes(r))&&l.username!==v.username)):g([])},[r]),i.useEffect(()=>{m(""),g([])},[k]);const{handleScroll:A}=z({fetchData:l=>N("Twitter",{action:r.length>0?"searchAccounts":"getRecentMessages",query:r.length>0&&r,page:l}),onDataFetched:l=>{r.length>0?g([...f,...l]):o([...R,...l])},perPage:15});return e(b,{children:w&&w.username?e(Qe,{data:w,goBack:()=>d(null)}):a(b,{children:[e(te,{search:l=>T(l),placeholder:s("APPS.TWITTER.SEARCH_DIRECT_MESSAGES")}),e("div",{className:"dms-container",onScroll:A,children:r.length>0?e("div",{className:"dm-users",children:f.length>0?f.map(l=>a("div",{className:"item",onClick:()=>d(l),children:[a("div",{className:"data",children:[e("div",{className:"profile-picture",children:e(M,{avatar:l.profile_picture})}),e("div",{className:"content",children:a("div",{className:"name",children:[e("span",{children:l.name}),a("span",{className:"username",children:["@",l.username]})]})})]}),e("div",{className:"timestamp",children:Pe(l.timestamp)})]})):e("div",{className:"search-for",children:s("APPS.TWITTER.SEARCH_FOR").format({search:r})})}):e("div",{className:"dm-users",children:R.map(l=>(l.content&&(l.content.includes("imgur.com")||l.content.includes("tenor.com")||l.content.includes(".png"))&&(l.content=s("APPS.TWITTER.SENT_ATTACHMENT")),a("div",{className:"item",onClick:()=>d(l),children:[a("div",{className:"data",children:[e("div",{className:"profile-picture",onClick:S=>{S.stopPropagation(),n.fetchAndSetProfile(l.username)},children:e(M,{avatar:l.profile_picture})}),a("div",{className:"content",children:[a("div",{className:"name",children:[e("span",{children:l.name}),a("span",{className:"username",children:["@",l.username]})]}),l.content&&e("div",{className:"text",children:l.content.length>30?l.content.substring(0,30)+"...":l.content})]})]}),e("div",{className:"timestamp",children:Pe(l.timestamp)})]})))})}),e("div",{className:"new-tweet",onClick:()=>h(!0),children:e(Ae,{})}),k&&a("div",{className:"new-message-container",children:[a("div",{className:"new-message-header",children:[e("div",{className:"cancel-text",onClick:()=>h(!1),children:s("APPS.TWITTER.CANCEL")}),e("div",{className:"title",children:s("APPS.TWITTER.NEW_MESSAGE")}),e("div",{})]}),a("div",{className:"new-message-body",children:[a("div",{className:"new-message-input",children:[s("APPS.TWITTER.TO"),":",e(V,{type:"text",maxLength:10,onChange:l=>m(l.target.value)})]}),e("div",{className:"results",children:f.map(l=>a("div",{className:"item",onClick:()=>d(l),children:[e("div",{className:"profile-picture",children:e(M,{avatar:l.profile_picture})}),a("div",{className:"name",children:[a("span",{children:[l.name,l.verified&&e("i",{className:"fas fa-badge-check verified"})]}),a("span",{className:"username",children:["@",l.username]})]})]}))})]})]})]})})}function et(){const{User:n,Func:c}=i.useContext(q),[v,r]=n,[m,t]=c.LoggedIn,[T,f]=i.useState(""),[g,R]=i.useState(1),[o,k]=i.useState(""),[h,w]=i.useState(""),[d,A]=i.useState(""),[l,S]=i.useState(null);i.useEffect(()=>{S(null)},[T,g]);const _=()=>{N("Twitter",{action:"login",data:{username:h,password:d}},{success:!!U.accounts[h],data:U.accounts[h]}).then(u=>{if(!(u!=null&&u.success))return S(u==null?void 0:u.error);N("isAdmin",null,!1).then(W=>{G.APPS.TWITTER.account.set(u.data),r({...u.data,isAdmin:W}),t(!0)})})},O=()=>{let u=h==null?void 0:h.toLowerCase().replace(/\s/g,""),W=u.match($.value.UsernameFilter);if(!W||(W==null?void 0:W[0])!==u){F("warning","Username did not match regex"),S("USERNAME_NOT_ALLOWED");return}N("Twitter",{action:"createAccount",data:{username:u.replace(/\s/g,""),password:d,name:o}},{success:!U.accounts[u]}).then(P=>{if(!(P!=null&&P.success))return S(P==null?void 0:P.error);let p={name:o,username:u,followers:0,following:0,date_joined:Math.floor(Date.now())};N("isAdmin",null,!1).then(x=>{G.APPS.TWITTER.account.set(p),r({...p,isAdmin:x}),t(!0)})})};return i.useEffect(()=>{w(""),A("")},[T]),a("div",{className:"login-container",children:[T===""&&a(b,{children:[a("div",{className:"login-header",children:[e("div",{}),e("img",{src:"assets/img/icons/twitter/logo.png"}),e("div",{})]}),e("div",{className:"login-body",children:s("APPS.TWITTER.SIGN_UP_TEXT")}),a("div",{className:"create-account",children:[e("div",{className:"button",onClick:()=>f("register"),children:s("APPS.TWITTER.CREATE_ACCOUNT")}),e("div",{className:"text",children:s("APPS.TWITTER.TERMS_OF_SERVICE")})]}),a("div",{className:"login-text",children:[s("APPS.TWITTER.HAS_ACCOUNT"),e("span",{onClick:()=>f("login"),children:s("APPS.TWITTER.LOGIN")})]})]}),T==="register"&&a(b,{children:[a("div",{className:"login-header",children:[e("div",{className:"cancel",onClick:()=>{f(""),R(1)},children:s("APPS.TWITTER.CANCEL")}),e("div",{className:"profile-picture",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),a("div",{className:"login",children:[e("div",{className:"text",children:s("APPS.TWITTER.CREATE_YOUR_ACCOUNT")}),e(V,{placeholder:s("APPS.TWITTER.NAME_PLACEHOLDER"),maxLength:30,onChange:u=>k(u.target.value)}),e(V,{className:"username",placeholder:s("APPS.TWITTER.USERNAME_PLACEHOLDER"),maxLength:15,onChange:u=>{var W;return w((W=u.target.value)==null?void 0:W.toLowerCase().replace(/\s/g,""))}}),e(V,{type:"password",placeholder:s("APPS.TWITTER.PASSWORD_PLACEHOLDER"),maxLength:50,onChange:u=>A(u.target.value)}),l&&e("div",{className:"error-text",children:s(`APPS.TWITTER.${l}`)})]}),e("div",{className:"buttons",children:e("div",{className:`button ${d.length>0&&(h==null?void 0:h.length)>2?"active":""}`,onClick:()=>{d.length>0&&(h==null?void 0:h.length)>2&&O()},children:s("APPS.TWITTER.CREATE_ACCOUNT")})})]}),T==="login"&&a(b,{children:[a("div",{className:"login-header",children:[e("div",{className:"cancel",onClick:()=>{f(""),R(1)},children:s("APPS.TWITTER.CANCEL")}),e("div",{className:"profile-picture",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),g===1&&a(b,{children:[a("div",{className:"login",children:[e("div",{className:"text",children:s("APPS.TWITTER.GET_STARTED")}),e(V,{placeholder:s("APPS.TWITTER.USERNAME_PLACEHOLDER"),maxLength:15,onChange:u=>w(u.target.value)})]}),a("div",{className:"footer",children:[e("div",{className:"forgot",children:s("APPS.TWITTER.FORGOT_PASSWORD")}),e("div",{className:`button ${h.length>2?"active":""}`,onClick:()=>{h.length>2&&R(g+1)},children:s("APPS.TWITTER.NEXT")})]})]}),g===2&&a(b,{children:[a("div",{className:"login",children:[e("div",{className:"text",children:s("APPS.TWITTER.ENTER_PASSWORD")}),e(V,{placeholder:s("APPS.TWITTER.USERNAME_PLACEHOLDER"),defaultValue:h,maxLength:15,type:"text",onChange:u=>w(u.target.value)}),e(V,{placeholder:s("APPS.TWITTER.PASSWORD_PLACEHOLDER"),type:"password",onChange:u=>A(u.target.value)}),l&&e("div",{className:"error-text",children:s(`APPS.TWITTER.${l}`)})]}),e("div",{className:"buttons",children:e("div",{className:ne("button",d&&(h==null?void 0:h.length)>2&&"active"),onClick:()=>{d&&(h==null?void 0:h.length)>2&&_()},children:s("APPS.TWITTER.LOGIN")})})]})]})]})}function X({data:n,last:c,pinned:v}){const{User:r,Func:m}=i.useContext(q),t=Z($),[T]=r,[f,g]=m.Tweet,[R,o]=m.View,[k,h]=m.Update;i.useState(!1);const w=i.useRef([]),[d,A]=i.useState(null),[l,S]=i.useState([]),[_,O]=i.useState({retweeted:!1,liked:!1}),[u,W]=i.useState({likes:0,retweets:0,replies:0});return i.useEffect(()=>{var P;if((P=n==null?void 0:n.tweet)!=null&&P.attachments)if(Array.isArray(n.tweet.attachments))S(n.tweet.attachments);else{const p=JSON.parse(n.tweet.attachments);p&&Array.isArray(p)&&S(JSON.parse(n.tweet.attachments))}O({retweeted:n.tweet.retweeted,liked:n.tweet.liked}),W({likes:n.tweet.likes,retweets:n.tweet.retweets,replies:n.tweet.replies})},[n]),i.useEffect(()=>{if(!j("Twitter"))return;if(!l||!w.current||w.current.length===0)return F("info","No attachments or video refs");const P=w.current.map(p=>{if(!p)return null;const x=new IntersectionObserver(E=>{E.forEach(C=>{C.isIntersecting?C.target.play().catch(L=>{F("error","Failed to play video",L)}):C.target.pause()})},{threshold:.5});return x.observe(p),x}).filter(Boolean);return()=>{P.forEach(p=>p.disconnect())}},[l]),Q("twitter:updateTweetData",P=>{P.tweetId===n.tweet.id&&W(p=>({...p,[P.data]:P.increment?p[P.data]+1:p[P.data]-1}))}),i.useEffect(()=>{if(n.tweet.date_created){let p=new Date(n.tweet.date_created),x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=p.getDate(),C=x[p.getMonth()],L=p.getFullYear();var P=Math.floor(new Date().getTime()-p.getTime())/1e3;P<0&&(P=1),L!==new Date().getFullYear()&&A(`${C} ${E}, ${L}`);let y=P/86400;return y>1?A(`${C} ${E}`):(y=P/3600,y>1?A(`${Math.floor(y)}h`):(y=P/60,y>1?A(`${Math.floor(y)}m`):A(`${Math.floor(y*60)}s`)))}},[n]),e(b,{children:n&&e(b,{children:a("div",{className:"tweet",id:c?"last":"",onClick:()=>{g(n),o("tweet")},children:[v&&a("div",{className:"pinned",children:[e("i",{className:"fas fa-thumbtack"})," ",s("APPS.TWITTER.PINNED_POST")]}),n.tweet.retweetedByUsername&&a("div",{className:"retweeted",onClick:P=>{P.stopPropagation(),m.fetchAndSetProfile(n.tweet.retweetedByUsername)},children:[e("i",{className:"far fa-retweet"}),n.tweet.retweetedByName," ",s("APPS.TWITTER.RETWEETED")]}),a("div",{className:"tweet-body",children:[e("div",{className:"profile-picture",children:e(M,{avatar:n.user.profile_picture,onClick:P=>{P.stopPropagation(),m.fetchAndSetProfile(n.user.username)}})}),a("div",{className:"tweet-content",children:[a("div",{className:"tweet-header",onClick:P=>{P.stopPropagation(),m.fetchAndSetProfile(n.user.username)},children:[a("div",{className:"user",children:[e("span",{className:"name",children:n.user.name}),n.user.private&&e(ie,{}),n.user.verified&&e("i",{className:"fas fa-badge-check verified"}),a("span",{className:"username",children:["@",n.user.username]}),e("span",{className:"time",children:d})]}),(T.username===n.user.username||T.isAdmin)&&e("div",{className:"dots",children:e(Re,{onClick:P=>{var x;P.stopPropagation();let p=[T.username===n.user.username&&{title:v?s("APPS.TWITTER.UNPIN"):s("APPS.TWITTER.PIN"),cb:()=>{N("Twitter",{action:"pinTweet",tweet_id:n.tweet.id,toggle:!v},!0).then(E=>{if(!E)return F("error","Failed to pin tweet");if(v)return v=!1})}},{title:s("APPS.TWITTER.DELETE_POPUP.TITLE"),color:"red",cb:()=>{D.PopUp.set({title:s("APPS.TWITTER.DELETE_POPUP.TITLE"),description:s("APPS.TWITTER.DELETE_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.TWITTER.DELETE_POPUP.CANCEL")},{title:s("APPS.TWITTER.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"deleteTweet",tweet_id:n.tweet.id},!0).then(()=>{h(!0)})}}]})}}].filter(Boolean);(x=t==null?void 0:t.PromoteBirdy)!=null&&x.Enabled&&!n.tweet.replyToId&&n.user.username===T.username&&p.push({title:s("APPS.TWITTER.PROMOTE"),cb:()=>{var E,C,L;D.PopUp.set({title:s("APPS.TWITTER.PROMOTE_POPUP.TITLE"),description:s("APPS.TWITTER.PROMOTE_POPUP.DESCRIPTION").format({price:t.CurrencyFormat.replace("%s",(C=(E=$)==null?void 0:E.value.PromoteBirdy)==null?void 0:C.Cost.toString()),views:(L=$)==null?void 0:L.value.PromoteBirdy.Views}),buttons:[{title:s("APPS.TWITTER.PROMOTE_POPUP.CANCEL")},{title:s("APPS.TWITTER.PROMOTE_POPUP.PROCEED"),cb:()=>{N("Twitter",{action:"promoteTweet",tweet_id:n.tweet.id},!0).then(y=>{n.tweet.promoted=!0})}}]})}}),D.ContextMenu.set({buttons:p})}})})]}),n.tweet.replyToId&&e("div",{className:"replying-to",onClick:P=>{P.stopPropagation(),N("Twitter",{action:"getTweet",tweetId:n.tweet.replyToId},U.tweets.find(p=>p.tweet.id===n.tweet.replyToId)).then(p=>{p&&p.tweet&&(g(p),o("tweet"))})},children:s("APPS.TWITTER.REPLYING_TO").format({name:`@${n.tweet.replyToAuthor}`})}),e("div",{className:"text",children:ee(n.tweet.content,!0,(P,p)=>{p.stopPropagation(),m.fetchAndSetProfile(P)})}),(l==null?void 0:l.length)>0&&e("div",{className:"attatchments",children:l==null?void 0:l.map((P,p)=>{var x;return e("div",{className:"attatchment",onClick:E=>{E.stopPropagation(),D.FullscreenImage.set(P)},children:K(P)?e("video",{src:P,muted:!0,controls:!1,loop:!0,autoPlay:!0,ref:E=>{w.current&&(w.current[p]=E)}}):e(J,{src:P,blur:((x=n.user)==null?void 0:x.username)!==(T==null?void 0:T.username)})},p)})}),a("div",{className:"actions",children:[a("div",{className:"action comment",children:[e("i",{className:"far fa-comment"}),u.replies]}),a("div",{className:`action retweet ${_.retweeted?"active":""}`,children:[e("i",{className:"fal fa-retweet",onClick:P=>{P.stopPropagation(),D.PopUp.set({title:_.retweeted?s("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):s("APPS.TWITTER.RETWEET_POPUP.RETWEET"),description:s("APPS.TWITTER.RETWEET_POPUP.DESCRIPTION").format({action:_.retweeted?s("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):s("APPS.TWITTER.RETWEET_POPUP.RETWEET")}),buttons:[{title:s("APPS.TWITTER.RETWEET_POPUP.CANCEL")},{title:s("APPS.TWITTER.RETWEET_POPUP.PROCEED"),cb:()=>{N("Twitter",{action:"toggleRetweet",tweet_id:n.tweet.id,retweeted:!_.retweeted},!_.retweeted).then(p=>{O({..._,retweeted:p})})}}]})}}),u.retweets]}),a("div",{className:`action like ${_.liked?"active":""}`,children:[e("i",{className:"fal fa-heart",onClick:P=>{P.stopPropagation(),N("Twitter",{action:"toggleLike",tweet_id:n.tweet.id,liked:!_.liked},!_.liked).then(p=>{O({..._,liked:p})})}}),u.likes]})]}),n.tweet.promoted&&a("div",{className:"promoted",children:[e(Ce,{})," ",s("APPS.TWITTER.PROMOTED")]})]})]})]})})})}const se=We(!1);function tt(){const n=Z(se),[c,v]=i.useState(null);i.useEffect(()=>{j("Twitter")&&N("Twitter",{action:"getNotifications",page:0},{requests:[],notifications:U.notifications}).then(m=>{if(!m)return F("warning","Failed to fetch notifications");v(m)})},[]);const{handleScroll:r}=z({fetchData:m=>N("Twitter",{action:"getNotifications",page:m}),onDataFetched:m=>v(t=>({notifications:[...t.notifications,...m.notifications],requests:m.requests})),perPage:25});return a(b,{children:[e(te,{notifications:!0}),e(pe,{children:n&&e(st,{})}),a("div",{className:"notifications-container",onScroll:r,children:[c!=null&&c.requests&&(c==null?void 0:c.requests)>0?a("div",{className:"notification-item follow",onClick:()=>se.set(!0),children:[e("i",{className:"fas fa-user"}),e("div",{className:"content",children:a("div",{className:"title",children:[e("span",{children:c.requests})," ",s("APPS.TWITTER.FOLLOWER_REQUESTS")]})})]}):null,c==null?void 0:c.notifications.map((m,t)=>e(at,{notification:m}))]})]})}const at=({notification:n})=>{var v,r;const c=n.type;return a("div",{className:`notification-item ${c}`,children:[c==="like"&&a(b,{children:[e("img",{className:"icon",src:"./assets/img/icons/twitter/heart.svg"}),a("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e(M,{avatar:n.profile_picture})}),a("div",{className:"title",children:[e("span",{children:n.name})," ",s("APPS.TWITTER.LIKED_TWEET")]}),n.content&&e("div",{className:"tweet-content",children:((v=n.content)==null?void 0:v.length)>100?n.content.substring(0,100)+"...":n.content})]})]}),c==="retweet"&&a(b,{children:[e("i",{className:"fas fa-repeat"}),a("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e(M,{avatar:n.profile_picture})}),a("div",{className:"title",children:[e("span",{children:n.name})," ",s("APPS.TWITTER.RETWEETED_TWEET")]}),n.content&&e("div",{className:"tweet-content",children:((r=n.content)==null?void 0:r.length)>100?n.content.substring(0,100)+"...":n.content})]})]}),c==="follow"&&a(b,{children:[e("i",{className:"fas fa-user"}),a("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e(M,{avatar:n.profile_picture})}),a("div",{className:"title",children:[e("span",{children:n.name})," ",s("APPS.TWITTER.FOLLOWED")]})]})]}),c==="reply"&&e(X,{data:{user:{profile_picture:n.profile_picture,name:n.name,username:n.username,verified:n.verified},tweet:{id:n.tweet_id,content:n.content,attachments:n.attachments,replies:n.reply_count,retweets:n.retweet_count,likes:n.like_count,liked:n.liked??!1,retweeted:n.retweeted??!1,date_created:n.timestamp,replyToId:n.replyToId,replyToAuthor:n.replyToAuthor}}})]})},st=()=>{const{Func:n}=i.useContext(q),[c,v]=i.useState([]);i.useEffect(()=>{j("Twitter")&&N("Twitter",{action:"getFollowRequests",page:0},null).then(t=>{if(!t)return F("warning","Failed to fetch follow requests");F("info","Fetched follow requests",t),v(t)})},[]);const{handleScroll:r}=z({fetchData:t=>N("Twitter",{action:"getFollowRequests",page:t}),onDataFetched:t=>v(t),perPage:25}),m=(t,T)=>{if(!t||T===void 0)return F("warning","No username / accept provided as an argument, cancelling request");N("Twitter",{action:"handleFollowRequest",username:t,accept:T}).then(f=>{if(!f)return F("warning","Failed to handle follow request");v(g=>g.filter(R=>R.username!==t))})};return e(b,{children:a(Ee.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"userpanel-container requests",children:[a("div",{className:"userpanel-header",children:[e("div",{onClick:()=>se.set(!1),children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"userpanel-title",children:s("APPS.TWITTER.FOLLOWER_REQUESTS")}),e("div",{})]}),e("div",{className:"items",onScroll:r,children:c.map((t,T)=>a("div",{className:"item",children:[a("div",{className:"item-header",children:[a("div",{className:"user",onClick:()=>n.fetchAndSetProfile(t.username),children:[e("div",{className:"profile-picture",children:e(M,{avatar:t.profile_picture})}),a("div",{className:"name",children:[e("span",{children:t.name}),a("span",{className:"username",children:["@",t.username]})]}),t.isFollowingYou&&e("div",{className:"follows",children:s("APPS.TWITTER.FOLLOWS_YOU")})]}),a("div",{className:"actions",children:[e(Oe,{className:"primary",onClick:f=>{f.stopPropagation(),m(t.username,!0)}}),e(_e,{className:"red",onClick:f=>{f.stopPropagation(),m(t.username,!1)}})]})]}),e("div",{className:"item-footer",children:t.bio})]},T))})]})})};function nt(){const{Func:n}=i.useContext(q),[c,v]=n.View;return e("div",{className:"footer",children:[{value:"timeline",activeIcon:e(Le,{}),icon:e(be,{})},{value:"search",activeIcon:e(ke,{}),icon:e(ye,{})},{value:"notifications",activeIcon:e(ve,{}),icon:e(De,{})},{value:"dmlist",activeIcon:e(Ue,{}),icon:e(ge,{})}].map((m,t)=>{let T=c==m.value;return e("div",{"data-active":T,onClick:()=>v(m.value),children:T?m.activeIcon:m.icon},t)})})}function it(){var R;const{User:n,Func:c,UserPanel:v}=i.useContext(q),[r,m]=v,[t,T]=i.useState([]);let f={[s("APPS.TWITTER.FOLLOWING")]:"getFollowing",[s("APPS.TWITTER.FOLLOWERS")]:"getFollowers",[s("APPS.TWITTER.LIKED_BY")]:"getLikes",[s("APPS.TWITTER.RETWEETED_BY")]:"getRetweeters"};i.useEffect(()=>{j("Twitter")&&N("Twitter",{action:f[r.data.title],data:{tweet_id:r.data.tweet_id,username:r.data.username,page:0}}).then(o=>{T(o)})},[]);const{handleScroll:g}=z({fetchData:o=>N("Twitter",{action:f[r.data.title],data:{tweet_id:r.data.tweet_id,username:r.data.username,page:o}}),onDataFetched:o=>T([...t,...o]),perPage:25});return e(b,{children:a("div",{className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("div",{onClick:()=>{var o;(o=r.data)==null||o.cb(),m({display:!1,data:null})},children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"userpanel-title",children:(R=r==null?void 0:r.data)==null?void 0:R.title}),e("div",{})]}),e("div",{className:"items",onScroll:g,children:t.map((o,k)=>e(rt,{account:o}))})]})})}const rt=n=>{const{User:c,Func:v}=i.useContext(q),[r]=c,m=n.account,[t,T]=i.useState(m.isFollowing);return e("div",{className:"item",children:a(b,{children:[a("div",{className:"item-header",children:[a("div",{className:"user",onClick:()=>v.fetchAndSetProfile(m.username),children:[e("div",{className:"profile-picture",children:e(M,{avatar:m.profile_picture})}),a("div",{className:"name",children:[e("span",{children:m.name}),a("span",{className:"username",children:["@",m.username]})]}),m.isFollowingYou&&e("div",{className:"follows",children:s("APPS.TWITTER.FOLLOWS_YOU")})]}),e("div",{className:"action",onClick:()=>{m.username!==r.username&&(t?D.PopUp.set({title:s("APPS.TWITTER.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TWITTER.UNFOLLOW_POPUP.DESCRIPTION").format({name:m.username}),buttons:[{title:s("APPS.TWITTER.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TWITTER.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"toggleFollow",data:{username:m.username,following:!t}},!0).then(()=>{T(f=>!f)})}}]}):N("Twitter",{action:"toggleFollow",data:{username:m.username,following:!t}},!0).then(f=>{T(g=>!g)}))},children:m.username===r.username?e("div",{className:"following",children:s("APPS.TWITTER.YOU")}):t?e("div",{className:"following",children:s("APPS.TWITTER.FOLLOWING")}):e("div",{className:"follow",children:s("APPS.TWITTER.FOLLOW")})})]}),e("div",{className:"item-footer",children:m.bio})]})})};function lt(){var oe,de,ue,me,Te,he;const{User:n,Func:c,UserPanel:v}=i.useContext(q),[r,m]=n,[t,T]=c.Profile,[f,g]=v,[R,o]=c.Update,[k,h]=c.LoggedIn,[w,d]=c.DmUser,[A,l]=c.View,[S,_]=i.useState("tweets"),[O,u]=i.useState([]),[W,P]=i.useState(null),[p,x]=i.useState(null),[E,C]=i.useState(!1);i.useEffect(()=>{j("Twitter")&&(u([]),o(!1),N("Twitter",{action:"getTweets",page:0,filter:{type:S==="tweets"?"user":S,username:t.username}},U.tweets.filter(I=>{var B,H;switch(S){case"tweets":return I.user.username===t.username;case"replies":return(H=(B=I.tweet)==null?void 0:B._replies)==null?void 0:H.find(Y=>Y.tweet.username===t.username);case"media":return I.tweet.attachments.length>0&&I.user.username===t.username;case"liked":return[];default:return[]}})).then(I=>{u(I)}))},[S,R]);const{handleScroll:L}=z({fetchData:I=>N("Twitter",{action:"getTweets",filter:{type:S==="tweets"?"user":S,username:t.username},page:I}),onDataFetched:I=>u([...O,...I]),perPage:25});i.useEffect(()=>{var I;if(t.date_joined){const B=new Date(t.date_joined);let H=B.toLocaleDateString((I=$.value)==null?void 0:I.DateLocale,{month:"long"}),Y=B.getFullYear();P(`${H} ${Y}`),x(t.profile_picture),r.username===t.username&&m({...r,...t})}},[t]);const y=i.useRef(!0);i.useEffect(()=>{if(y.current){y.current=!1;return}N("Twitter",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}})},[t.isFollowing]),Q("twitter:updateProfileData",I=>{I.username===t.username&&T({...t,[I.data]:I.increment?t[I.data]+1:t[I.data]-1})});const ce={tweets:s("APPS.TWITTER.TWEETS"),replies:s("APPS.TWITTER.REPLIES"),media:s("APPS.TWITTER.MEDIA"),liked:s("APPS.TWITTER.LIKES")};return a(b,{children:[E&&a("div",{className:"edit-profile-container",children:[a("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>C(!1),children:s("APPS.TWITTER.CANCEL")}),e("div",{className:"title",children:s("APPS.TWITTER.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>{N("Twitter",{action:"updateProfile",data:{name:t.name,bio:t.bio,profile_picture:t.profile_picture,header:t.header,private:t.private}},!0).then(I=>{if(!I)return F("warning","Could not save profile, updateProfile did not callback");C(!1),G.APPS.TWITTER.account.set(t)})},children:s("APPS.TWITTER.SAVE")})]}),e("div",{className:"banner-wrapper",children:t.header?a(b,{children:[e(J,{className:"profile-banner",src:t.header,blur:t.username!==r.username,onClick:()=>{var I,B,H;D.Gallery.set({allowExternal:(H=(B=(I=$)==null?void 0:I.value)==null?void 0:B.AllowExternal)==null?void 0:H.Birdy,onSelect:Y=>T({...t,header:Y.src})})}}),e(ae,{})]}):e("div",{className:"profile-banner",onClick:()=>{var I,B,H;D.Gallery.set({allowExternal:(H=(B=(I=$)==null?void 0:I.value)==null?void 0:B.AllowExternal)==null?void 0:H.Birdy,onSelect:Y=>T({...t,header:Y.src})})},children:e(ae,{})})}),a("div",{className:"profile-info",children:[a("div",{className:"logo",onClick:()=>{var I,B,H;D.Gallery.set({allowExternal:(H=(B=(I=$)==null?void 0:I.value)==null?void 0:B.AllowExternal)==null?void 0:H.Birdy,onSelect:Y=>T({...t,profile_picture:Y.src})})},children:[e(M,{avatar:t.profile_picture}),e(ae,{})]}),a("div",{className:"items",children:[a("div",{className:"item",children:[s("APPS.TWITTER.NAME"),e(V,{onChange:I=>T({...t,name:I.target.value}),defaultValue:t.name})]}),a("div",{className:"item",children:[s("APPS.TWITTER.BIO"),e(re,{onChange:I=>T({...t,bio:I.target.value}),rows:2,maxLength:100,defaultValue:t.bio})]}),a("div",{className:"item",children:[s("APPS.TWITTER.JOIN_DATE"),e(V,{disabled:!0,value:W})]}),a("div",{className:"item",children:[s("APPS.TWITTER.PROTECTED_POSTS"),e(Xe,{checked:t.private,onChange:()=>T({...t,private:!t.private})})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{D.PopUp.set({title:s("APPS.TWITTER.SIGN_OUT_POPUP.TITLE"),description:s("APPS.TWITTER.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.TWITTER.SIGN_OUT_POPUP.CANCEL")},{title:s("APPS.TWITTER.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"signOut"},!0).then(()=>{h(!1),G.APPS.TWITTER.account.set(!1)})}}]})},children:e("div",{children:s("APPS.TWITTER.SIGN_OUT")})}),((ue=(de=(oe=$)==null?void 0:oe.value)==null?void 0:de.ChangePassword)==null?void 0:ue.Birdy)&&e("div",{className:"button red",onClick:()=>Fe("Twitter",()=>{}),children:e("div",{children:s("APPS.TWITTER.CHANGE_PASSWORD")})}),((he=(Te=(me=$)==null?void 0:me.value)==null?void 0:Te.DeleteAccount)==null?void 0:he.Birdy)&&e("div",{className:"button red",onClick:()=>{xe("Twitter",()=>{h(null),m(null),G.APPS.TWITTER.account.set(null)})},children:e("div",{children:s("APPS.TWITTER.DELETE_ACCOUNT")})})]})]})]}),a("div",{className:"profile",children:[a("div",{className:"profile-header",children:[t.header?e(J,{src:t.header}):e("div",{}),e("div",{className:"go-back",onClick:()=>l("timeline"),children:e(Be,{})})]}),a("div",{className:"profile-details",children:[a("div",{className:"top",children:[e("div",{className:"profile-picture",children:e(M,{avatar:p})}),e("div",{className:"action-buttons",children:a(b,{children:[t.username!==r.username&&a(b,{children:[e("div",{className:"button",onClick:()=>{d({username:t.username,name:t.name,profile_picture:p,verified:t.verified}),l("dmlist")},children:e(ge,{})}),t.isFollowing&&e("div",{className:"button",onClick:()=>{var I;D.PopUp.set({title:s("APPS.TWITTER.NOTIFICATIONS_POPUP.TITLE"),description:s("APPS.TWITTER.NOTIFICATIONS_POPUP.DESCRIPTION").format({action:(I=t.notificationsEnabled?s("APPS.TWITTER.NOTIFICATIONS_POPUP.DISABLE"):s("APPS.TWITTER.NOTIFICATIONS_POPUP.ENABLE"))==null?void 0:I.toLowerCase(),name:t.username}),buttons:[{title:s("APPS.TWITTER.NOTIFICATIONS_POPUP.CANCEL")},{title:s("APPS.TWITTER.NOTIFICATIONS_POPUP.PROCEED"),color:t.notificationsEnabled?"red":null,cb:()=>{N("Twitter",{action:"toggleNotifications",data:{username:t.username,toggle:!t.notificationsEnabled}},!t.notificationsEnabled).then(B=>T({...t,notificationsEnabled:B}))}}]})},children:t.notificationsEnabled?e(ve,{}):e(Me,{})})]}),t.username===r.username?e("div",{className:"edit",onClick:()=>C(!0),children:s("APPS.TWITTER.EDIT_PROFILE")}):t.isFollowing?e("div",{className:"following",onClick:()=>{D.PopUp.set({title:s("APPS.TWITTER.UNFOLLOW_POPUP.TITLE"),description:s("APPS.TWITTER.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:s("APPS.TWITTER.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.TWITTER.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{T({...t,isFollowing:!1,notificationsEnabled:!1})}}]})},children:s("APPS.TWITTER.FOLLOWING")}):e(b,{children:e("div",{className:"follow",onClick:()=>{t.private?N("Twitter",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(I=>{I&&T({...t,requested:!t.requested})}):T({...t,isFollowing:!0})},children:t.requested?s("APPS.TWITTER.PENDING"):s("APPS.TWITTER.FOLLOW")})})]})})]}),a("div",{className:"profile-bottom",children:[a("div",{className:"name-area",children:[a("span",{className:"name",children:[t.name," ",t.verified&&e("i",{className:"fas fa-badge-check verified"}),t.private&&e(ie,{})]}),a("span",{className:"username",children:["@",t.username,t.isFollowingYou&&e("div",{className:"follows",children:s("APPS.TWITTER.FOLLOWS_YOU")})]})]}),e("div",{className:"bio",children:ee(t.bio,!0)}),a("div",{className:"joindate",children:[e("i",{className:"far fa-calendar-alt"}),s("APPS.TWITTER.JOINED").format({date:W})]}),a("div",{className:"stats",children:[a("div",{"data-disabled":!t.isFollowing&&t.private&&t.username!==r.username,onClick:()=>{!t.isFollowing&&t.private&&t.username!==r.username||g({display:!0,data:{title:s("APPS.TWITTER.FOLLOWING"),username:t.username,cb:()=>c.fetchAndSetProfile(t.username)}})},children:[e("span",{children:t.following})," ",s("APPS.TWITTER.FOLLOWING")]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&t.username!==r.username,onClick:()=>{!t.isFollowing&&t.private&&t.username!==r.username||g({display:!0,data:{title:s("APPS.TWITTER.FOLLOWERS"),username:t.username,cb:()=>c.fetchAndSetProfile(t.username)}})},children:[e("span",{children:t.followers})," ",s("APPS.TWITTER.FOLLOWERS")]})]}),!(!t.isFollowing&&t.private&&t.username!==r.username)&&e("div",{className:"categories",children:Object.keys(ce).map(I=>e("div",{className:`category ${S===I?"active":""}`,onClick:()=>_(I),children:ce[I]},I))})]})]}),!t.isFollowing&&t.private&&t.username!==r.username?a("div",{className:"protected-tweets-container",children:[e("div",{className:"title",children:s("APPS.TWITTER.PROTECTED_TWEETS_TITLE")}),e("div",{className:"description",children:s("APPS.TWITTER.PROTECTED_TWEETS_DESCRIPTION").format({username:t.username})})]}):e("div",{className:"profile-tweets-container",children:a("div",{className:"tweets",onScroll:L,children:[t.pinnedTweet&&S==="tweets"&&e(X,{data:t.pinnedTweet,pinned:!0}),O.map((I,B)=>e(X,{data:I}))]})})]})]})}function ct(){const{Func:n}=i.useContext(q),[c,v]=i.useState(""),[r,m]=i.useState(""),[t,T]=i.useState([]),[f,g]=i.useState([]),[R,o]=i.useState("");i.useEffect(()=>{j("Twitter")&&N("Twitter",{action:"getRecentHashtags"}).then(h=>{h&&g(h)})},[]),i.useEffect(()=>{const h=setTimeout(()=>v(r),500);return()=>clearTimeout(h)},[r]),i.useEffect(()=>{c.length>0&&N("Twitter",{action:"searchAccounts",query:c},Object.keys(U.accounts).filter(h=>{var w;return(h==null?void 0:h.toLowerCase().includes(c==null?void 0:c.toLowerCase()))||((w=U.accounts[h].name)==null?void 0:w.toLowerCase().includes(c==null?void 0:c.toLowerCase()))}).map(h=>U.accounts[h])).then(h=>{h&&T(h)})},[c]);const{handleScroll:k}=z({fetchData:h=>c.length>0?N("Twitter",{action:"searchAccounts",query:c,page:h},Object.keys(U.accounts).filter(w=>{var d;return(w==null?void 0:w.toLowerCase().includes(c==null?void 0:c.toLowerCase()))||((d=U.accounts[w].name)==null?void 0:d.toLowerCase().includes(c==null?void 0:c.toLowerCase()))}).map(w=>U.accounts[w])):R.length>0?N("Twitter",{action:"searchTweets",query:R,page:h}):Promise.resolve([]),onDataFetched:h=>T(w=>[...w,...h]),perPage:25});return a(b,{children:[e(te,{search:h=>m(h)}),e("div",{className:"searchpage-container",children:c.length>0||R.length>0?e(b,{children:e("div",{className:"search-results",onScroll:k,children:t.length>0?t.map(h=>{if(h.tweet)return e(X,{data:h});{let w=h;return a("div",{className:"item",onClick:()=>n.fetchAndSetProfile(w.username),children:[e("div",{className:"profile-picture",children:e(M,{avatar:w.profile_picture})}),a("div",{className:"name",children:[a("span",{children:[w.name,w.verified&&e("i",{className:"fas fa-badge-check verified"}),w.private&&e(ie,{})]}),a("span",{className:"username",children:["@",w.username]})]})]})}}):e("div",{className:"search-for",children:s("APPS.TWITTER.SEARCH_FOR").format({search:c})})})}):a(b,{children:[a("div",{className:"twitter-banner",children:[e("img",{src:"./assets/img/icons/twitter/banner.png"}),e("div",{className:"text",children:s("APPS.TWITTER.START_SEARCHING")})]}),f.length>0&&a("div",{className:"recent-hashtags",children:[e("div",{className:"title",children:s("APPS.TWITTER.TRENDING_HASHTAGS")}),e("div",{className:"hashtags",children:f.map(h=>a("div",{className:"item",children:[a("div",{className:"hashtag",onClick:()=>{N("Twitter",{action:"searchTweets",query:h.hashtag,page:0}).then(w=>{w&&(o(h.hashtag),T(w))})},children:["#",h.hashtag]}),a("div",{className:"uses",children:[qe(h.uses,!0)," ",h.uses>1?"Tweets":"Tweet"]})]}))})]})]})})]})}function le(n){var t,T;const{User:c}=i.useContext(q),[v]=c,[r,m]=i.useState({content:"",attachments:(t=n.data)!=null&&t.attachments?(T=n.data)==null?void 0:T.attachments:[]});return a("div",{className:"new-tweet-container",children:[a("div",{className:"new-tweet-header",children:[e("div",{className:"cancel-text",onClick:()=>n.goBack(),children:s("APPS.TWITTER.CANCEL")}),e("div",{className:"tweet-button",onClick:()=>{if(r.content.length>0||r.attachments.length>0){let f=[...r.content.split(" ").filter(g=>g.startsWith("#")).filter((g,R,o)=>o.indexOf(g)===R).map(g=>g.replace("#",""))];N("Twitter",{action:"sendTweet",data:{username:v.username,content:r.content,attachments:r.attachments.length>0?r.attachments:null,replyTo:n.isReply,hashtags:f}},!0).then(g=>{if(!g)return F("error","Failed to send tweet!");n.onSend()})}},children:s("APPS.TWITTER.TWEET")})]}),a("div",{className:"message-container",children:[a("div",{className:"message-top",children:[v&&e("div",{className:"profile-picture",children:e(M,{avatar:v.profile_picture})}),e(re,{maxLength:280,id:"textArea",value:r.content,onChange:f=>{m({...r,content:f.target.value});let g=f.target.scrollHeight;f.target.style.height=g+"px"},placeholder:n.isReply?s("APPS.TWITTER.TWEET_REPLY"):s("APPS.TWITTER.TWEET_GENERAL")})]}),e("div",{className:"tweet-attatchments",children:r.attachments.map((f,g)=>a("div",{className:"tweet-attatchment",children:[K(f)?e("video",{src:f,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e("img",{src:f}),e("i",{className:"fal fa-times",onClick:()=>{m({...r,attachments:r.attachments.filter((R,o)=>o!==g)})}})]},g))}),a("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{var f,g,R;r.attachments.length<2&&D.Gallery.set({includeVideos:!0,allowExternal:(R=(g=(f=$)==null?void 0:f.value)==null?void 0:g.AllowExternal)==null?void 0:R.Birdy,onSelect:o=>m({...r,attachments:[...r.attachments,o.src]})})},children:e(He,{})}),e("div",{className:"button",onClick:()=>{D.Emoji.set({onSelect:f=>m(g=>({content:`${g.content}${f.emoji}`,attachments:g.attachments}))})},children:e(Ge,{})})]})]})]})}function ot(){const{User:n,Func:c}=i.useContext(q),[v]=c.Timeline,[r]=n,[m,t]=c.Update,[T,f]=i.useState([]),[g,R]=i.useState(!1),[o,k]=i.useState(0),[h,w]=i.useState(!1),[d,A]=i.useState(!1),[l,S]=i.useState(!1);return Q("twitter:newTweet",O=>{var W,P,p;if(!O)return F("warning","No tweet data was provided for the twitter:newTweet event, returning.");if((W=O.tweet)!=null&&W.replyToId)return F("info","Tweet is reply, not adding to timeline");if(!((P=O.tweet)!=null&&P.content)||v==="following")return;f([O,...T]);let u=(p=document.querySelector(".tweets-container"))==null?void 0:p.scrollTop;S(u&&u>0)}),i.useEffect(()=>{if(!j("Twitter"))return;w(!1),A(!1),t(!1),k(0),f([]);let O=v==="following"?{type:"following",username:r.username}:null;N("Twitter",{action:"getTweets",page:0,filters:O},U.tweets).then(u=>{if(!u)return F("warning","No tweets returned from server");f(u)})},[v,m,r==null?void 0:r.username]),a(b,{children:[e(te,{}),e(pe,{children:l?e(dt,{hide:()=>S(!1)}):null}),g&&e("div",{className:"reply-area",children:e(le,{onSend:()=>R(!1),goBack:()=>R(!1)})}),e("div",{className:"tweets-container",onScroll:()=>{var P;if(h||d)return;let O=(P=document.querySelector(".tweets-container"))==null?void 0:P.scrollTop;O&&l&&O<1&&S(!1);let u=document.querySelector("#last");if(!u)return;!$e(u)&&(A(!0),N("Twitter",{action:"getTweets",page:o+1,filter:{type:v==="following"?"following":void 0,username:v==="following"?r.username:void 0}},null).then(p=>{p&&p.length>0?(f([...T,...p]),A(!1)):w(!0)}),k(p=>p+1))},children:T==null?void 0:T.map((O,u)=>{let W=u===T.length-1;return e(X,{data:O,last:W},u)})})]})}const dt=({hide:n})=>a(Ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},className:"new-tweets",onClick:()=>{let c=document.querySelector(".tweets-container");c&&(c.scrollTo({top:0,behavior:"smooth"}),n==null||n())},children:[e(Ve,{}),s("APPS.TWITTER.NEW_POSTS")]});function ut(){const{Func:n,User:c,UserPanel:v}=i.useContext(q),[r]=c,[m,t]=n.Tweet,[T,f]=n.View,[g,R]=v,[o,k]=i.useState(m),[h,w]=i.useState([]),[d,A]=i.useState(null),[l,S]=i.useState([]),[_,O]=i.useState(!1);i.useState(0),i.useState(!1),i.useState(!1);const[u,W]=i.useState({retweeted:!1,liked:!1}),[P,p]=i.useState({likes:0,retweets:0});i.useEffect(()=>{var E;if(k(m),S([]),(E=o==null?void 0:o.tweet)!=null&&E.attachments)if(Array.isArray(o.tweet.attachments))S(o.tweet.attachments);else{const C=JSON.parse(o.tweet.attachments);C&&Array.isArray(C)&&S(JSON.parse(o.tweet.attachments))}W({retweeted:o.tweet.retweeted,liked:o.tweet.liked}),p({likes:o.tweet.likes,retweets:o.tweet.retweets})},[o,m]),i.useEffect(()=>{if(o.tweet.date_created){const E=new Date(o.tweet.date_created);let C=E.getDate(),L=E.getMonth()+1,y=E.getFullYear();A(`${E.getHours()}:${E.getMinutes()}Â· ${C}/${L}/${y}`)}},[o]),Q("twitter:updateTweetData ",E=>{E.tweetId===o.tweet.id&&p({...P,[E.data]:E.increment?P[E.data]+1:P[E.data]-1})}),i.useEffect(()=>{var E;j("Twitter")&&(w([]),N("Twitter",{action:"getTweets",page:0,filter:{type:"replyTo",tweet_id:m.tweet.id}},(E=U.tweets.find(C=>C.tweet.id===m.tweet.id))==null?void 0:E.tweet._replies).then(C=>{w(C)}))},[m,_]);const{handleScroll:x}=z({fetchData:E=>N("Twitter",{action:"getTweets",filter:{type:"replyTo",tweet_id:o.tweet.id},page:E}),onDataFetched:E=>w([...h,...E]),perPage:25});return a(b,{children:[a("div",{className:ne("viewtweet-container",_&&"replying"),children:[a("div",{className:"viewtweet-header",children:[e("div",{onClick:()=>f("timeline"),children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"viewtweet-title",children:s("APPS.TWITTER.TWEET")}),e("div",{})]}),a("div",{className:"viewtweet-body",children:[a("div",{className:"viewtweet-content-header",children:[e("div",{className:"profile-picture",onClick:()=>n.fetchAndSetProfile(o.user.username),children:e(M,{avatar:o.user.profile_picture})}),a("div",{className:"profile-name",children:[a("div",{className:"name",children:[o.user.name," ",o.user.verified&&e("i",{className:"fas fa-badge-check verified"})]}),a("span",{children:["@",o.user.username]})]})]}),o.tweet.replyToId&&a("div",{className:"replying-to",onClick:E=>{E.stopPropagation(),N("Twitter",{action:"getTweet",tweetId:o.tweet.replyToId},U.tweets.find(C=>C.tweet.id===o.tweet.replyToId)).then(C=>{t(C)})},children:[s("APPS.TWITTER.REPLYING_TO").format({name:""})," ",a("span",{children:["@",o.tweet.replyToAuthor]})]}),a("div",{className:"content",children:[ee(o.tweet.content,!0,n.fetchAndSetProfile),(l==null?void 0:l.length)>0&&e("div",{className:"attachment",children:l.map((E,C)=>{var L;return K(E)?e(mt,{src:E,id:C,onClick:()=>{D.FullscreenImage.set(E)}},C):e(J,{src:E,blur:((L=o.user)==null?void 0:L.username)!==(r==null?void 0:r.username),onClick:()=>{D.FullscreenImage.set(E)}},C)})})]}),e("div",{className:"date",children:d})]}),a("div",{className:"stats",children:[a("div",{className:"stats-item",onClick:()=>{R({display:!0,data:{title:s("APPS.TWITTER.RETWEETED_BY"),tweet_id:o.tweet.id,cb:()=>{t(o),f("tweet")}}})},children:[e("span",{children:P.retweets})," Retweets"]}),a("div",{className:"stats-item",onClick:()=>{R({display:!0,data:{title:s("APPS.TWITTER.LIKED_BY"),tweet_id:o.tweet.id,cb:()=>{t(o),f("tweet")}}})},children:[e("span",{children:P.likes})," ",s("APPS.TWITTER.LIKES")]})]}),a("div",{className:"buttons",children:[e("div",{className:"button comment",children:e("i",{className:"fal fa-comment",onClick:()=>O(!0)})}),e("div",{className:`button retweet ${u.retweeted?"active":""}`,children:e("i",{className:"fal fa-retweet",onClick:()=>{D.PopUp.set({title:u.retweeted?s("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):s("APPS.TWITTER.RETWEET_POPUP.RETWEET"),description:s("APPS.TWITTER.RETWEET_POPUP.DESCRIPTION").format({action:u.retweeted?s("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):s("APPS.TWITTER.RETWEET_POPUP.RETWEET")}),buttons:[{title:s("APPS.TWITTER.RETWEET_POPUP.CANCEL")},{title:u.retweeted?s("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):s("APPS.TWITTER.RETWEET_POPUP.RETWEET"),cb:()=>{N("Twitter",{action:"toggleRetweet",tweet_id:o.tweet.id,retweeted:!u.retweeted},!u.retweeted).then(E=>{W({...u,retweeted:E})})}}]})}})}),e("div",{className:`button like ${u.liked?"active":""}`,children:e("i",{className:"fal fa-heart",onClick:E=>{E.stopPropagation(),N("Twitter",{action:"toggleLike",tweet_id:o.tweet.id,liked:!u.liked},!u.liked).then(C=>{W({...u,liked:C})})}})})]}),e("div",{className:"tweet-replies",children:e("div",{className:"tweets",onScroll:x,children:h.map((E,C)=>e(X,{data:E},C))})})]}),_&&e("div",{className:"reply-area",children:e(le,{onSend:()=>O(!1),goBack:()=>O(!1),isReply:o.tweet.id})})]})}const mt=({src:n,id:c,onClick:v})=>e("video",{src:n,id:c,autoPlay:!0,loop:!0,muted:!0,onClick:()=>v()}),Pt=["#gay","#pride","#99kr"],q=i.createContext(null);function wt(){var E,C;const n=Z(Je.Settings),c=(E=Z(Ke))==null?void 0:E.active,[v,r]=i.useState(null),[m,t]=i.useState(!1),[T,f]=i.useState("timeline"),[g,R]=i.useState("default"),[o,k]=i.useState(null),[h,w]=i.useState(null),[d,A]=i.useState(null),[l]=i.useState(!1),[S,_]=i.useState(!1),[O,u]=i.useState({display:!1,data:null}),[W,P]=i.useState(!0);i.useEffect(()=>{var L,y;c&&((L=c==null?void 0:c.data)==null?void 0:L.view)==="profile"&&p((y=c==null?void 0:c.data)==null?void 0:y.username)},[c]),i.useEffect(()=>{N("isAdmin",null,!1).then(L=>{if(G.APPS.TWITTER.account.value){r({...G.APPS.TWITTER.account.value,isAdmin:L}),t(!0),P(!1);return}else{if(G.APPS.TWITTER.account.value===!1)return P(!1);N("Twitter",{action:"isLoggedIn"},U.account).then(y=>{y?(G.APPS.TWITTER.account.set(y),r({...y,isAdmin:L}),t(!0)):G.APPS.TWITTER.account.set(!1),P(!1)})}})},[]),i.useEffect(()=>{O.display&&f("userpanel")},[O]),i.useEffect(()=>(we.ReceiveAppNotifications.set(!d),()=>{we.ReceiveAppNotifications.set(!0)}),[T]),Q("twitter:logout",L=>{if(!L)return F("warning","No username provided to logout");if(!m)return F("info","User is not logged in, cannot log out");L===(v==null?void 0:v.username)&&(t(!1),r(null),G.APPS.TWITTER.account.set(null))});const p=L=>{if(!L)return F("warning","No username provided.");N("Twitter",{action:"getProfile",data:{username:L}},U.accounts[L]).then(y=>{if(!y)return F("warning","No profile found for",L);w(y),f("profile")})},x={timeline:e(ot,{}),profile:e(lt,{}),tweet:e(ut,{}),search:e(ct,{}),notifications:e(tt,{}),userpanel:e(it,{}),dmlist:e(Ze,{})};return e(q.Provider,{value:{User:[v,r],Func:{View:[T,f],Timeline:[g,R],Profile:[h,w],Tweet:[o,k],Update:[S,_],LoggedIn:[m,t],DmUser:[d,A],fetchAndSetProfile:p},UserPanel:[O,u]},children:W||!je()?e("div",{className:"loading",children:e(Ye,{size:40,lineWeight:5,speed:2,color:((C=n==null?void 0:n.display)==null?void 0:C.theme)==="dark"?"#fff":"#000"})}):e("div",{className:"twitter-container",children:m===!0?a(b,{children:[x==null?void 0:x[T],T==="new-tweet"&&e("div",{className:"reply-area",children:e(le,{data:c==null?void 0:c.data,goBack:()=>f("timeline"),onSend:()=>f("timeline")})}),T==="timeline"&&!l&&e("div",{className:"new-tweet",onClick:()=>f("new-tweet"),children:e(ze,{})}),e(nt,{})]}):e(et,{})})})}export{q as TwitterContext,wt as default,Pt as rainbowHashtags};
