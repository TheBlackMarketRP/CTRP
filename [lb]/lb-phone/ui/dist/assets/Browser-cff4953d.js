import{a as n,a7 as ke,b9 as Se,r as E,u as F,j as R,bD as Ie,d as ye,L as P,X as he,bE as be,Z as Re,v as L,F as Ne,bF as We,bG as Ae,t as Be,P as Pe,Q as Oe,m as re,a8 as Ce,ay as we,H as Le,b as G,bH as q,bI as Te,bJ as De,bK as Ue,bL as xe,K as J,A as He}from"./index-eaa656b5.js";function ne({data:e}){return e!=null&&e.icon?n(ke,{src:e.icon,onError:r=>{e.id&&M(e.id,{icon:void 0})}}):n(Se,{})}function Fe({active:e}){const[r,c]=E.useState(""),[o,m]=E.useState(!0),w=F(H),N=F(ce),h=u=>{oe(u)},k=N.slice(-10).reverse();return n("div",{className:"empty-tab","data-active":e,children:R("div",{className:"empty-tab-content",children:[n("img",{className:"logo",src:"https://lbscripts.com/assets/logo.png"}),R("div",{className:"searchbar",children:[n(Ie,{}),n(ye,{type:"text",placeholder:P("APPS.BROWSER.SEARCH_PLACEHOLDER"),value:r,onChange:u=>c(u.target.value),onKeyUp:u=>u.key==="Enter"&&oe(u.currentTarget.value)})]}),R("div",{className:"empty-tab-sections",children:[R("div",{className:"empty-tab-section-tabs",children:[R("button",{className:he("empty-tab-section-tab",o&&"active"),onClick:()=>m(!0),children:[n(be,{}),n("span",{children:P("APPS.BROWSER.BOOKMARKS")})]}),R("button",{className:he("empty-tab-section-tab",!o&&"active"),onClick:()=>m(!1),children:[n(Re,{}),n("span",{children:P("APPS.BROWSER.HISTORY")})]})]}),n("div",{className:"empty-tab-list",children:o?w.length>0?w.map((u,d)=>R("div",{className:"empty-tab-item",onClick:()=>h(u.url),children:[n(ne,{data:u}),R("div",{className:"empty-tab-item-content",children:[n("div",{className:"empty-tab-item-title",children:u.title||u.url}),n("div",{className:"empty-tab-item-url",children:u.url})]})]},d)):n("div",{className:"empty-tab-empty-state",children:P("APPS.BROWSER.NO_BOOKMARKS")}):k.length>0?k.map((u,d)=>R("div",{className:"empty-tab-item",onClick:()=>h(u.link),children:[n(ne,{data:{icon:u.icon}}),R("div",{className:"empty-tab-item-content",children:[n("div",{className:"empty-tab-item-title",children:u.title||u.link}),n("div",{className:"empty-tab-item-url",children:u.link})]})]},d)):n("div",{className:"empty-tab-empty-state",children:P("APPS.BROWSER.NO_HISTORY")})})]})]})})}function Ke({data:e,active:r,addRef:c}){var V;const o=F(Pe.Settings),m=F(_),[w,N]=E.useState(!1),h=E.useRef(null),[k,u]=E.useState(null),d=E.useRef(null),W=E.useRef(!0),p=E.useRef(e.url||""),s=E.useRef(null),z=E.useRef(null),C=E.useRef(),v=E.useRef(!1),S=A=>{if(!v.current){if(v.current=!0,L("warning",`Iframe blocked: ${A}`),s.current&&(clearInterval(s.current),s.current=null),C.current){try{C.current()}catch{}C.current=void 0}if(h.current)try{h.current.src="about:blank"}catch{}N(!0)}};return E.useEffect(()=>{const A=t=>{const i=t.message||"";return i.includes("ResizeObserver")?(t.preventDefault(),t.stopPropagation(),!0):i.includes("frame-ancestors")||i.includes("X-Frame-Options")||i.includes("Refused to frame")||i.includes("Refused to display")||i.includes("Content Security Policy")?(!v.current&&e.url&&S("CSP/X-Frame-Options error caught by window handler"),t.preventDefault(),t.stopPropagation(),!0):!1},b=t=>{var y;const i=((y=t.reason)==null?void 0:y.toString())||"";(i.includes("frame")||i.includes("CSP")||i.includes("X-Frame"))&&(!v.current&&e.url&&S("CSP/X-Frame-Options error in promise"),t.preventDefault())},l=t=>t instanceof ErrorEvent?A(t):!1,x=t=>{var i,y;((i=t.violatedDirective)!=null&&i.includes("frame-ancestors")||(y=t.effectiveDirective)!=null&&y.includes("frame-ancestors")||t.blockedURI)&&(!v.current&&e.url&&S(`CSP violation: ${t.violatedDirective||"frame-ancestors"}`),t.preventDefault(),t.stopPropagation())};return window.addEventListener("error",l,!0),window.addEventListener("unhandledrejection",b,!0),document.addEventListener("securitypolicyviolation",x,!0),()=>{window.removeEventListener("error",l,!0),window.removeEventListener("unhandledrejection",b,!0),document.removeEventListener("securitypolicyviolation",x,!0)}},[e.url]),E.useEffect(()=>{if(k)return d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{k&&(M(e.id,k,W.current),W.current&&(W.current=!1))},250),()=>{d.current&&clearTimeout(d.current)}},[k,e.id]),E.useEffect(()=>(s.current&&(clearInterval(s.current),s.current=null),N(!1),v.current=!1,()=>{s.current&&(clearInterval(s.current),s.current=null)}),[e==null?void 0:e.id,m]),E.useEffect(()=>{if(s.current&&(clearInterval(s.current),s.current=null),C.current){try{C.current()}catch{}C.current=void 0}if(N(!1),v.current=!1,e.url&&h.current&&h.current.src!==e.url&&!v.current)try{h.current.src=e.url,p.current=e.url}catch{S("Failed to set iframe src")}},[e.url]),E.useEffect(()=>()=>{if(s.current&&(clearInterval(s.current),s.current=null),d.current&&(clearTimeout(d.current),d.current=null),C.current){try{C.current()}catch{}C.current=void 0}},[]),E.useEffect(()=>{var A;if(z.current&&z.current.contentDocument)try{z.current.contentDocument.body.setAttribute("data-theme",((A=o==null?void 0:o.display)==null?void 0:A.theme)??"light")}catch(b){L("error","Error setting iframe theme:",b)}},[(V=o==null?void 0:o.display)==null?void 0:V.theme]),R(Ne,{children:[w&&R("div",{className:"failed-load",children:[n(We,{}),n("div",{className:"subtitle",children:P("APPS.BROWSER.FAILED_LOAD_PAGE")})]}),n("iframe",{ref:A=>{A&&(h.current=A,c(A))},src:w?"about:blank":e.url,title:e.title,"data-active":r,style:{display:w?"none":"block"},onError:A=>{try{S("Iframe load error detected")}catch(b){try{console.error("Error in iframe onError handler:",b),N(!0)}catch{}}},onLoad:async A=>{var b;try{const l=A.target;if(v.current)return;let x="";try{if(x=l.src||"",x.startsWith("chrome-error://")||x.startsWith("chrome://")||x.includes("chromewebdata")){S("Iframe src is chrome-error");return}}catch{}N(!1),v.current=!1,C.current&&C.current();let t="",i=!1,y=!1;try{if(t=l.contentWindow.location.href,y=!0,p.current=t,t.startsWith("chrome-error://")||t.startsWith("chrome://")||t.includes("chromewebdata")||t.includes("chrome-error")){S("Site blocked iframe embedding (chrome-error URL)");return}}catch{y=!1,t=e.url||"",p.current=t}let $=!1;try{if($=!!l.contentDocument,!$&&!y){S("Cannot access iframe location or document - blocked by CSP/X-Frame-Options");return}}catch{S("Cannot access iframe document (threw error) - blocked by CSP/X-Frame-Options");return}if(i||v.current){S("Detected as blocked");return}let f=null,U=!1;try{if(f=l.contentDocument,U=!!f,!f){S("Cannot access iframe document - may be blocked");return}try{if(f.location&&f.location.href){const a=f.location.href;if(a.startsWith("chrome-error://")||a.startsWith("chrome://")||a.includes("chromewebdata")){S("Document URL is chrome-error");return}}}catch{}}catch{S("Error accessing iframe document - likely blocked");return}if(!f){S("Cannot access iframe document - likely blocked");return}if(!(e.url&&(e.url.startsWith("/")||e.url.includes("gsearch.html")||!e.url.startsWith("http")&&!e.url.startsWith("chrome-error")))&&f.head.childElementCount===0&&r&&!Ae()){S("Iframe document appears empty - may be blocked");return}if(v.current)return;try{f.documentElement&&(f.documentElement.style.fontSize="calc((1vh + 1vw) * 1.214)"),f.body&&f.body.setAttribute("data-theme",((b=o==null?void 0:o.display)==null?void 0:b.theme)??"light")}catch{}let j=e.title||t,ue;try{if(U&&f){j=f.title||j;const a=f.querySelector("link[rel='icon']");ue=a==null?void 0:a.href}}catch(a){L("warning","Error accessing document properties:",a)}if(u(a=>({...a,title:j,icon:ue,link:t})),t.startsWith("chrome-error://")||t.startsWith("chrome://")||t.includes("chromewebdata")){S("Detected chrome-error page");return}let K=null,Q=null;const de=()=>{if(!v.current)try{const a=l.contentWindow.location.href;if(a.startsWith("chrome-error://")||a.startsWith("chrome://")||a.includes("chromewebdata")){S("Detected chrome-error in popstate");return}p.current=a,u(I=>({...I,link:a}))}catch{y||S("Cannot access location in popstate - may be blocked")}};if(l.contentWindow&&!v.current)try{l.contentWindow.addEventListener("popstate",de)}catch{S("Cannot add event listener - may be blocked");return}let Y=null,Z=null,ee=null,te=null;if(U&&!v.current&&h.current){const a=f.querySelector("title");if(a&&(K=new MutationObserver(I=>{if(v.current||!h.current||!l){K&&(K.disconnect(),K=null);return}try{if(!l.contentWindow)return;const B=l.contentWindow.location.href;u(g=>({...g,title:f.title,link:B})),p.current=B}catch{if(v.current)return;u(g=>({...g,title:f.title}))}}),K.observe(a,{subtree:!0,characterData:!0,childList:!0})),l.contentWindow.navigation&&l.contentWindow.navigation.addEventListener&&!v.current&&h.current){Q=I=>{v.current||!h.current||(u(B=>({...B,link:I.destination.url})),p.current=I.destination.url)};try{l.contentWindow.navigation.addEventListener("navigate",Q)}catch{}}Y=I=>{if(!v.current)try{const g=I.target.closest("a");if(g&&g.href){if(g.target==="_blank"||I.ctrlKey||I.metaKey||I.shiftKey)return;const D=g.href;D&&D!==p.current&&!D.startsWith("javascript:")&&!D.startsWith("#")&&D.startsWith("http")&&(p.current=D,M(e.id,{link:D},!1),u(X=>({...X,link:D})))}}catch(B){L("error","Error in click handler:",B)}},f.addEventListener("click",Y,!0),Z=I=>{if(!(v.current||!h.current))try{const g=I.target.closest("a");if(g&&g.href&&g.href.startsWith("http")&&!g.href.startsWith("javascript:")){const D=g.href;D!==p.current&&setTimeout(()=>{if(!(v.current||!h.current))try{if(!(l!=null&&l.contentWindow))return;const X=l.contentWindow.location.href;X!==p.current&&(p.current=X,M(e.id,{link:X},!1))}catch{D!==p.current&&h.current&&(p.current=D,M(e.id,{link:D},!1))}},500)}}catch(B){L("error","Error in mousedown handler:",B)}},f.addEventListener("mousedown",Z,!0),ee=I=>{if(v.current)return;const B=I.target;if(B&&B.action){const g=B.action;g&&g!==p.current&&(p.current=g,M(e.id,{link:g},!1))}},f.addEventListener("submit",ee,!0)}const fe=()=>{if(v.current){s.current&&(clearInterval(s.current),s.current=null);return}if(!r){s.current&&(clearInterval(s.current),s.current=null);return}if(!h.current||!l){s.current&&(clearInterval(s.current),s.current=null);return}try{if(!l.contentWindow){s.current&&(clearInterval(s.current),s.current=null);return}const a=l.contentWindow.location.href;if(a.startsWith("chrome-error://")||a.startsWith("chrome://")||a.includes("chromewebdata")){S("Detected chrome-error in URL check interval");return}a!==p.current&&a&&(p.current=a,M(e.id,{link:a},!1),u(I=>({...I,link:a,title:U?f==null?void 0:f.title:(I==null?void 0:I.title)||a})))}catch{y?S("Lost access to iframe location - may be blocked"):s.current&&(clearInterval(s.current),s.current=null)}};if(!v.current&&l&&h.current){s.current&&(clearInterval(s.current),s.current=null),s.current=setInterval(()=>{if(v.current||!h.current||!r){s.current&&(clearInterval(s.current),s.current=null);return}fe()},300),te=()=>{v.current||!h.current||setTimeout(()=>{v.current||!h.current||fe()},300)};try{l.addEventListener("load",te)}catch{S("Cannot add load event listener - may be blocked")}}if(z.current=l,C.current=()=>{var a,I,B;s.current&&(clearInterval(s.current),s.current=null);try{te&&l&&l.removeEventListener("load",te)}catch{}try{Y&&U&&f&&f.removeEventListener("click",Y,!0)}catch{}try{Z&&U&&f&&f.removeEventListener("mousedown",Z,!0)}catch{}try{ee&&U&&f&&f.removeEventListener("submit",ee,!0)}catch{}try{Q&&((a=l==null?void 0:l.contentWindow)!=null&&a.navigation)&&((B=(I=l.contentWindow.navigation).removeEventListener)==null||B.call(I,"navigate",Q))}catch{}try{l!=null&&l.contentWindow&&l.contentWindow.removeEventListener("popstate",de)}catch{}if(K){try{K.disconnect()}catch{}K=null}},U)try{l.contentWindow.fetchNui=Be;const a=f.createElement("script");a.innerHTML=`
                    (function() {
                        try {
                            let addedHandlers = [];

                            function refreshInputs(inputs) {
                                inputs.forEach((input) => {
                                    if (addedHandlers.includes(input)) return;

                                    input.addEventListener('focus', () => {
                                        try {
                                            fetchNui('toggleInput', true, 'ok');
                                        } catch (e) {
                                            // Ignore errors
                                        }
                                    });
                                    input.addEventListener('blur', () => {
                                        try {
                                            fetchNui('toggleInput', false, 'ok');
                                        } catch (e) {
                                            // Ignore errors
                                        }
                                    });
                                });
                            }

                            refreshInputs(document.querySelectorAll('input, textarea'));

                            const inputObserver = new MutationObserver((mutations) => {
                                try {
                                    mutations.forEach((mutation) => {
                                        mutation.addedNodes.forEach((node) => {
                                            try {
                                                if (node.childNodes.length > 0) refreshInputs(node.querySelectorAll('input, textarea'));
                                                if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') refreshInputs([node]);
                                            } catch (err) {
                                                // Ignore errors from individual nodes
                                            }
                                        });
                                    });
                                } catch (err) {
                                    // Ignore observer errors
                                }
                            });

                            inputObserver.observe(document.body, { childList: true, subtree: true });
                        } catch (e) {
                            // Ignore all errors in injected script
                        }
                    })();
                `;try{f.body.appendChild(a)}catch(I){L("error","Failed to inject script into iframe:",I)}}catch(a){L("error","Error setting up iframe content:",a)}}catch{try{S("Error in iframe onLoad handler")}catch{N(!0)}}}})]})}function _e({visible:e,onClose:r}){const c=F(O),o=F(_),m=E.useRef(null),w=d=>{_.set(d),r()},N=(d,W)=>{d.stopPropagation(),se(W),c.length===1&&r()},h=()=>{ie()},k=()=>{c.forEach(d=>{d.id!==o&&se(d.id)}),c.length===1&&r()},u=(d,W,p)=>{Math.abs(W.offset.y)>150&&(se(p),c.length===1&&r())};return n(Oe,{children:e&&n(re.div,{className:"tab-switcher-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,children:R(re.div,{className:"tab-switcher-container",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},ref:m,onClick:d=>d.stopPropagation(),children:[n("div",{className:"tab-switcher-header",children:n("div",{className:"tab-switcher-header-content",children:R("div",{className:"tab-switcher-tab-count",children:[c.length," ",c.length===1?P("APPS.BROWSER.TAB"):P("APPS.BROWSER.TABS")]})})}),n("div",{className:"tab-switcher-content",children:R("div",{className:"tab-switcher-grid",children:[c.map((d,W)=>R(re.div,{className:"tab-switcher-card","data-active":d.id===o,initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:-20},transition:{delay:W*.03,duration:.2},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.3,onDragEnd:(p,s)=>u(p,s,d.id),onClick:()=>w(d.id),style:{zIndex:c.length-W},children:[R("div",{className:"tab-switcher-card-header",children:[R("div",{className:"tab-switcher-card-header-left",children:[n(ne,{data:d}),n("span",{className:"tab-switcher-card-title",children:d.title||P("APPS.BROWSER.NEW_TAB")})]}),n("button",{className:"tab-switcher-card-close",onClick:p=>N(p,d.id),children:n(Ce,{})})]}),n("div",{className:"tab-switcher-card-preview",children:d.url?n("iframe",{src:d.url,className:"tab-switcher-card-iframe",title:d.title||"Tab preview"}):n("div",{className:"tab-switcher-card-empty",children:n(ne,{data:d})})})]},d.id)),R(re.div,{className:"tab-switcher-card tab-switcher-card-add",initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},transition:{delay:c.length*.03,duration:.2},onClick:h,children:[n(we,{}),n("span",{children:P("APPS.BROWSER.NEW_TAB")})]})]})}),R("div",{className:"tab-switcher-footer",children:[n("button",{className:"tab-switcher-footer-button",onClick:k,children:P("APPS.BROWSER.CLOSE_ALL")}),n("button",{className:"tab-switcher-footer-button tab-switcher-footer-button-done",onClick:r,children:P("APPS.BROWSER.DONE")})]})]})})})}const $e=()=>"/ui/dist".replace(/\/$/,""),ge=e=>`${$e()}/gsearch.html?cx=${G.value.Browser.CX}&q=${encodeURIComponent(e)}`,O=J([]),me=localStorage.getItem(`${q.value}-lb-phone:bookmarks`),je=me?JSON.parse(me):[],_=J(null),H=J(je),T=J({}),ve=localStorage.getItem(`${q.value}-lb-phone:browserHistory`),ce=J(ve?JSON.parse(ve):[]);function Xe(){var x;const e=E.useRef([]),r=F(O),c=F(_),o=F(H),m=(x=F(He))==null?void 0:x.active,[w,N]=E.useState(""),[h,k]=E.useState(!1),[u,d]=E.useState(!1),[W,p]=E.useState(!1),s=t=>{if(t=t??r.find(y=>y.id===c),!(t!=null&&t.url))return;if(H.value.find(y=>y.url===t.url)){z(t.url);return}let i=[...H.value,{...t,id:void 0}];H.set(i),localStorage.setItem(`${q.value}-lb-phone:bookmarks`,JSON.stringify(i)),k(!0)},z=t=>{var $;const i=t??(($=r.find(f=>f.id===c))==null?void 0:$.url);if(!i)return;let y=H.value.filter(f=>f.url!==i);H.set(y),localStorage.setItem(`${q.value}-lb-phone:bookmarks`,JSON.stringify(y)),k(!1)};E.useEffect(()=>{var t;if(Le("Browser"))return O.value.length===0&&ie(),H.set([...((t=G.value.Browser)==null?void 0:t.DefaultBookmarks)??[],...H.value.filter(i=>{var U,ae;let y=!i.id,$=y&&!((ae=(U=G.value.Browser)==null?void 0:U.DefaultBookmarks)!=null&&ae.find(j=>j.url===i.url)),f=y&&H.value.find(j=>j.url===i.url);return!$&&!f})]),()=>{let i=ce.value;localStorage.setItem(`${q.value}-lb-phone:browserHistory`,JSON.stringify(i))}},[m]),E.useEffect(()=>{const t=r.find(i=>i.id===c);W||(t!=null&&t.url?N(pe(t.url)):N("")),k(!!o.find(i=>i.url===(t==null?void 0:t.url)))},[c,r,o,W]);const C=()=>{const t=e.current[c],i=T.value[c];if(!t||!i)return L("warning","No iframe / history found");const y=i.currentIndex;if(y===0)return L("warning","Already at first page");t.src=i.history[y-1],i.currentIndex=y-1,T.patch({[c]:i})},v=()=>{const t=e.current[c],i=T.value[c];if(!t||!i)return L("warning","No iframe / history found");const y=i.currentIndex;if(y===i.history.length-1)return L("warning","Already at last page");t.src=i.history[y+1],i.currentIndex=y+1,T.patch({[c]:i})},S=()=>{var i;const t=e.current[c];t&&((i=t.contentWindow)==null||i.location.reload())},V=()=>{const t=T.value[c];return(t==null?void 0:t.currentIndex)>0},A=()=>{const t=T.value[c];return t&&t.currentIndex<t.history.length-1},b=r.find(t=>t.id===c),l=b==null?void 0:b.url;return R("div",{className:"browser-container","data-has-header":l,children:[l&&R("div",{className:"browser-header",children:[R("div",{className:"browser-header-controls",children:[n("button",{className:"browser-header-button",onClick:C,disabled:!V(),title:"Back",children:n(Te,{})}),n("button",{className:"browser-header-button",onClick:v,disabled:!A(),title:"Forward",children:n(De,{})}),n("button",{className:"browser-header-button",onClick:S,title:"Refresh",children:n(Ue,{})})]}),n("div",{className:"browser-header-url",children:n("span",{children:b!=null&&b.title&&b.title!==b.url&&b.title!==P("APPS.BROWSER.NEW_TAB")?b.title:(b==null?void 0:b.url)||""})}),n("div",{className:"browser-header-actions",children:n("button",{className:"browser-header-button",onClick:()=>s(),title:h?P("APPS.BROWSER.BOOKMARK_REMOVE"):P("APPS.BROWSER.BOOKMARK"),children:h?n(be,{}):n(xe,{})})})]}),n("div",{className:"browser-content",children:r.map(t=>t.url?n(Ke,{data:t,active:t.id===c,addRef:i=>e.current[t.id]=i},t.id):n(Fe,{active:t.id===c},t.id))}),R("div",{className:"browser-footer",children:[n(ye,{className:"browser-input",type:"text",value:w,placeholder:(b==null?void 0:b.url)??P("APPS.BROWSER.SEARCH_PLACEHOLDER"),onFocus:()=>p(!0),onBlur:()=>{p(!1);const t=r.find(i=>i.id===c);t!=null&&t.url&&N(pe(t.url))},onFocusCapture:t=>t.currentTarget.select(),onKeyUp:t=>{t.key==="Enter"&&(p(!1),oe(t.currentTarget.value))},onChange:t=>N(t.currentTarget.value)}),R("div",{className:"buttons",children:[n("div",{className:"button",onClick:()=>ie(),title:P("APPS.BROWSER.NEW_TAB"),children:n(we,{})}),n("div",{className:"button",onClick:()=>d(!u),title:"Tabs",children:r.length})]})]}),n(_e,{visible:u,onClose:()=>d(!1)})]})}const Me=e=>{if(!e)return L("warning","No data provided to add to long history, returning");ce.set([...ce.value,{title:e.title,icon:e.icon,link:e.url,date:Date.now()}])},oe=e=>{if(!e||e.trim()==="")return;if(!Ee(e))return L("warning","Website not allowed");let r=e.trim();const c=r;le(r)?r.match(/^https?:\/\//i)||(r="https://"+r):r=ge(r);const o=_.value;if(O.set([...O.value.map(m=>{if(m.id===o){const w=c.includes(" ")||!le(c)?c:r;return{...m,url:r,title:w}}return m})]),o&&T.value[o]){const m=T.value[o].history,w=T.value[o].currentIndex;m[w]!==r&&T.patch({[o]:{history:[...m.slice(0,w+1),r],currentIndex:w+1}})}},ie=e=>{var m;let r=e;if(r&&(r=le(r)?r:ge(r)),!Ee(r))return L("warning","Website not allowed");const c=((m=crypto==null?void 0:crypto.randomUUID)==null?void 0:m.call(crypto))??Math.random().toString(36).substring(2,15)+Date.now().toString(36),o={id:c,url:r,title:r||P("APPS.BROWSER.NEW_TAB")};r&&T.patch({[c]:{history:[r],currentIndex:0}}),O.set([...O.value,o]),_.set(c)},se=e=>{var r,c;if(O.value.length===1&&ie(),_.value===e){const o=O.value.findIndex(w=>w.id===e),m=((r=O.value[o+1])==null?void 0:r.id)??((c=O.value[o-1])==null?void 0:c.id);_.set(m)}O.set([...O.value.filter(o=>o.id!==e)]),T.patch({[e]:void 0})},M=(e,r,c)=>{var d;let o=c===!0,{title:m,icon:w,link:N}=r;const h=O.value.find(W=>W.id===e);if(!h)return;const k={...h};let u=!1;if(m&&m.trim()!==""&&k.title!==m&&(k.title=m.trim(),u=!0),w&&k.icon!==w&&(k.icon=w,u=!0),N&&k.url!==N){k.url=N;const W=((d=T.value[e])==null?void 0:d.history)||[];T.patch({[e]:{history:[...W,N],currentIndex:W.length}}),o=!0,u=!0}if(o&&Me(k),u||o){const W=O.value.filter(p=>p.id!==e);O.set([...W,k])}},pe=e=>{if(!e)return"";if(e.includes("gsearch.html"))try{const c=new URL(e,window.location.origin).searchParams.get("q");return c?decodeURIComponent(c):e}catch{const c=e.match(/[?&]q=([^&]*)/);return c?decodeURIComponent(c[1]):e}return e},le=e=>{if(!e||e.trim()===""||(e=e.trim(),e.includes(" ")))return!1;const r=e.includes("."),c=/^https?:\/\//i.test(e),o=/^localhost/i.test(e),m=/^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/.test(e);return c||o||m?!0:r?/^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*\.[a-z]{2,}(\/.*)?$/i.test(e):!1},Ee=e=>{var o,m,w,N,h,k;let r=(w=(m=(o=G)==null?void 0:o.value)==null?void 0:m.Browser)==null?void 0:w.BlacklistedDomains,c=(k=(h=(N=G)==null?void 0:N.value)==null?void 0:h.Browser)==null?void 0:k.WhitelistedDomains;return!e||!r||!c?!0:(r==null?void 0:r.length)>0&&r.some(u=>e.includes(u))?!1:(c==null?void 0:c.length)===0?!0:c.some(u=>e.includes(u))};export{_ as ActiveTab,H as Bookmarks,ce as LongHistory,T as TabHistory,O as Tabs,ie as addTab,Xe as default,se as removeTab,oe as setTab,M as updateTabData};
