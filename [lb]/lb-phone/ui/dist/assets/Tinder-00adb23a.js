import{am as _e,ar as F,r as d,j as a,a as e,bY as Oe,k as Fe,H as ie,t as D,Q as Me,m as Ae,L as m,d as $,a8 as ee,bK as Ue,cz as Ve,u as U,P as V,F as G,I as He,i as $e,cG as se,bM as ne,C as O,b as ae,ay as Re,v as K,w as Y,K as We,N as he,a2 as Ce,bI as Be,a7 as z,X as De,ad as Ie,a6 as ce,q as Se,aR as Ge,cj as Ye,A as je,ch as ge,as as ze,ap as Ke,aX as le,ac as Xe,b0 as qe}from"./index-eaa656b5.js";import{T as ke}from"./Textarea-998d5eb2.js";var Je=function(o){return new Promise(function(l){setTimeout(l,o)})};const fe=_e(Je),L={snapBackDuration:300,maxTilt:5,bouncePower:.1,swipeThreshold:100},Qe=t=>{const o=window.getComputedStyle(t),l=o.getPropertyValue("width"),p=Number(l.split("px")[0]),v=o.getPropertyValue("height"),M=Number(v.split("px")[0]);return{x:p,y:M}},we=(t,o)=>Math.sqrt(Math.pow(t,2)+Math.pow(o,2)),Ze=(t,o=1)=>{const l=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return{x:t.x*o/l,y:t.y*o/l}},de=async(t,o,l=!1)=>{const p=oe(t),v=Qe(document.body),M=we(v.x,v.y),r=we(o.x,o.y),E=M/r,A=M/r,f=pe(o.x*A+p.x,-o.y*A+p.y);let h="";const u=200;l?t.style.transition="ease "+E+"s":t.style.transition="ease-out "+E+"s",J(t)===0?h=Q((Math.random()-.5)*u):J(t)>0?h=Q(Math.random()*u/2+J(t)):h=Q((Math.random()-1)*u/2+J(t)),t.style.transform=f+h,await fe(E*1e3)},Te=async t=>{t.style.transition=L.snapBackDuration+"ms";const o=oe(t),l=pe(o.x*-L.bouncePower,o.y*-L.bouncePower),p=Q(J(t)*-L.bouncePower);t.style.transform=l+p,await fe(L.snapBackDuration*.75),t.style.transform="none",await fe(L.snapBackDuration),t.style.transition="10ms"},ye=t=>{if(Math.abs(t.x)>Math.abs(t.y)){if(t.x>L.swipeThreshold)return"right";if(t.x<-L.swipeThreshold)return"left"}else{if(t.y>L.swipeThreshold)return"up";if(t.y<-L.swipeThreshold)return"down"}return"none"},xe=(t,o)=>{const l=o.x-t.x,p=t.y-o.y,v=(o.time-t.time)/1e3;return{x:l/v,y:p/v}},pe=(t,o)=>"translate("+t+"px)",Q=t=>"rotate("+t+"deg)",oe=t=>{const o=window.getComputedStyle(t),l=new DOMMatrix(o.transform);return{x:l.m41,y:-l.m42}},J=t=>{const o=window.getComputedStyle(t),l=new DOMMatrix(o.transform);return-Math.asin(l.m21)/(2*Math.PI)*360},et=(t,o,l,p)=>{const v={x:t.x+l.x,y:t.y+l.y},M={x:v.x,y:v.y,time:new Date().getTime()},r=pe(v.x),E=xe(p,M).x/1e3,A=Q(E*L.maxTilt);return o.style.transform=r+A,M},ue=t=>{const o=t.targetTouches[0];return{x:o.clientX,y:o.clientY}},me=t=>({x:t.clientX,y:t.clientY}),tt=F.forwardRef(({flickOnSwipe:t=!0,children:o,onSwipe:l,onCardLeftScreen:p,className:v,preventSwipe:M=[],swipeRequirementType:r="velocity",swipeThreshold:E=L.swipeThreshold,onSwipeRequirementFulfilled:A,onSwipeRequirementUnfulfilled:f},h)=>{L.swipeThreshold=E;const u=F.useRef(!1),b=F.useRef();F.useImperativeHandle(h,()=>({async swipe(P="right"){l&&l(P);const w=1e3,s=(Math.random()-.5)*100;P==="right"?await de(b.current,{x:w,y:s},!0):P==="left"&&await de(b.current,{x:-w,y:s},!0),b.current.style.display="none",p&&p(P)},async restoreCard(){b.current.style.display="block",await Te(b.current)}}));const i=F.useCallback(async(P,w)=>{if(u.current)return;u.current=!0;const s=oe(P),T=ye(r==="velocity"?w:s);if(T!=="none"&&(l&&l(T),t&&!M.includes(T))){const g=r==="velocity"?w:Ze(s,600);await de(P,g),P.style.display="none",p&&p(T);return}Te(P)},[u,t,l,p,M,r]),y=F.useCallback(()=>{u.current=!1},[u]);return F.useLayoutEffect(()=>{let P={x:null,y:null},w={x:0,y:0},s={x:0,y:0,time:new Date().getTime()},T=!1,g="none";b.current.addEventListener("touchstart",c=>{c.preventDefault(),y(),P={x:-ue(c).x,y:-ue(c).y}},{passive:!1}),b.current.addEventListener("mousedown",c=>{c.preventDefault(),T=!0,y(),P={x:-me(c).x,y:-me(c).y}});const n=c=>{if(A||f){const N=ye(r==="velocity"?w:oe(b.current));N!==g&&(g=N,g==="none"?f&&f():A&&A(N))}const S=et(c,b.current,P,s);w=xe(s,S),s=S};b.current.addEventListener("touchmove",c=>{c.preventDefault(),n(ue(c))},{passive:!1}),b.current.addEventListener("mousemove",c=>{c.preventDefault(),T&&n(me(c))}),b.current.addEventListener("touchend",c=>{c.preventDefault(),i(b.current,w)},{passive:!1}),b.current.addEventListener("mouseup",c=>{T&&(c.preventDefault(),T=!1,i(b.current,w))}),b.current.addEventListener("mouseleave",c=>{T&&(c.preventDefault(),T=!1,i(b.current,w))})},[]),F.createElement("div",{ref:b,className:v},o)});function ve(){const{View:t}=d.useContext(j),[o,l]=t;return a("div",{className:"home-header",children:[e(Oe,{onClick:()=>l("profile")}),e("img",{className:"logo",src:"./assets/img/icons/tinder/logo.svg",onClick:()=>l("home")}),e(Fe,{onClick:()=>l("messageList")})]})}const W={account:{name:"James",bio:"I'm a cool guy",dob:9624888e5,photos:["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp","https://r2.fivemanage.com/images/98avzSwlgzsg.webp","https://r2.fivemanage.com/images/rafgjPwSYnn2.png"],showMen:!1,showWomen:!0,isMale:!0,active:!0},accounts:[{number:"1",dob:9653888e5,name:"Jessica",bio:"Swipe right if you like dogs",photos:["https://r2.fivemanage.com/images/oRKcdeTA8oBy.png"],isMale:!1,matched:!0},{number:"2",dob:9653888e5,name:"Klara",bio:"Member of Lost MC, looking for a good time",photos:["https://r2.fivemanage.com/images/787FMzhn5xD5.png","https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png"],isMale:!1,liked:!0},{number:"3",dob:9653888e5,name:"Steph",bio:"Evening strolls are my thing",photos:["https://r2.fivemanage.com/images/7zj3Xgy6FsXK.png"],matched:!0,isMale:!1,lastMessage:"I'm perfect, you look good!",lastSender:"1234567890"},{number:"4",dob:9653888e5,name:"Lisa",bio:"I love to cook and bake",photos:["https://r2.fivemanage.com/images/7zj3Xgy6FsXK.png"],matched:!0,isMale:!1,lastMessage:"I love to cook and bake",lastSender:"4",unread:!0}],messages:{3:[{id:1,sender:"1234567890",content:"Im perfect, you look good!",timestamp:Date.now()-1e3*60*60*24*1},{id:2,sender:"1234567890",content:"I'm good, how about you?",timestamp:Date.now()-1e3*60*60*24*2},{id:3,sender:"1234567890",content:"Hey, how are you?",timestamp:Date.now()-1e3*60*60*24*3}],4:[{id:1,sender:"4",content:"HIII",timestamp:Date.now()-1e3*60*60*20}]}};function st(){var Ee;const{View:t,User:o,Account:l}=d.useContext(j),[p,v]=t,[M,r]=o,[E,A]=l,[f,h]=d.useState([]),[u,b]=d.useState(0),[i,y]=d.useState(),P=d.useRef(u),w=d.useRef(0),[s,T]=d.useState([]),[g,n]=d.useState(0),[c,S]=d.useState(!1),[N,R]=d.useState(null);let[k,H]=d.useState("");d.useEffect(()=>{ie("Tinder")&&D("Tinder",{action:"getFeed",page:0},W.accounts.filter(I=>!I.matched)).then(I=>{I&&I.length>0?(h(I),b(I.length-1),w.current=I.length,T(Array(I.length).fill(0).map(C=>F.createRef()))):S(!0)})},[]);const X=I=>{b(I),P.current=I},q=u<f.length-1,x=u>=0,B=(I,C,_)=>{y(I),X(_-1),Pe(),I==="right"?D("Tinder",{action:"swipe",like:!0,number:C.number},W.accounts.find(te=>te.liked&&te.number==C.number)).then(te=>{te&&R(C)}):I==="left"&&D("Tinder",{action:"swipe",like:!1,number:C.number})},Ne=(I,C)=>{P.current>=C&&s[C].current.restoreCard()},be=async I=>{x&&u<f.length&&(await s[u].current.swipe(I),Pe())},Le=async()=>{var C,_;if(!q)return;const I=u+1;X(I),await((_=(C=s[I])==null?void 0:C.current)==null?void 0:_.restoreCard())},Pe=()=>{if(w.current>1){w.current=w.current-1;return}D("Tinder",{action:"getFeed",page:g+1}).then(I=>{if(I)if(I&&I.length>0){n(g+1);let C=I.length+f.length;h(_=>(_=[..._,...I],_)),w.current=I.length,b(C-1),T(Array(C).fill(0).map(_=>F.createRef()))}else S(!0)})};return a("div",{className:`home-wrapper slide ${p=="profile"?"left":"right"}`,children:[e(ve,{}),e(Me,{children:N&&a(Ae.div,{initial:{opacity:0,scale:.1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.1},transition:{duration:.3,ease:"easeInOut"},className:"match",style:{backgroundImage:`url(${N.photos[0]})`},children:[e("img",{className:"match-image",src:"./assets/img/icons/tinder/match.png"}),a("div",{className:"likes-too",children:[N.name," ",(Ee=m("APPS.TINDER.LIKES_YOU_TOO"))==null?void 0:Ee.toLowerCase()]}),a("div",{className:"input",children:[e($,{type:"text",placeholder:m("APPS.TINDER.SAY_SOMETHING_NICE"),onChange:I=>H(I.target.value)}),e("div",{className:"send",onClick:()=>{D("Tinder",{action:"sendMessage",data:{recipient:N.number,content:k}},!0).then(I=>{I&&(r(N),v("message"))})},children:m("APPS.TINDER.SEND")})]}),e("div",{className:"keep-swiping",onClick:()=>R(null),children:m("APPS.TINDER.KEEP_SWIPING")})]})}),a("div",{className:"home-body",children:[a("div",{className:"cards",children:[c&&e("div",{className:"card no-more",children:e("div",{children:m("APPS.TINDER.NO_MORE")})}),!E.active&&e("div",{className:"card no-more",children:e("div",{children:m("APPS.TINDER.HIDDEN_PROFILE")})}),E.active&&f.map((I,C)=>e(tt,{ref:s[C],className:"swipe",onSwipe:_=>B(_,I,C),onCardLeftScreen:()=>Ne(I,C),children:e(nt,{user:I})},C))]}),a("div",{className:"actions",children:[e("div",{className:"button",onClick:()=>be("left"),children:e(ee,{style:{color:"#F24C65"}})}),e("div",{className:`button small ${q?"":"disabled"}`,onClick:()=>Le(),children:e(Ue,{style:{rotate:"180deg",color:"#F2B721"}})}),e("div",{className:"button",onClick:()=>be("right"),children:e(Ve,{style:{color:"#3CDBA7"}})})]})]})]})}const nt=t=>{let o=t.user;const[l,p]=d.useState(0),[v,M]=d.useState(0);return d.useEffect(()=>{M(Z(o.dob))},[o]),a("div",{className:"card",style:{backgroundImage:`url(${o.photos[l]})`},onClick:r=>{l<o.photos.length-1?p(l+1):p(0)},children:[o.photos.length>1&&e("div",{className:"image-count",children:o.photos.map((r,E)=>e("div",{className:`image ${E==l?"active":""}`,onClick:A=>{A.stopPropagation(),p(E)}}))}),a("div",{className:"card-content",children:[a("div",{className:"name",children:[o.name," ",e("span",{children:v})]}),e("div",{className:"description",children:o.bio})]})]})};function at(){var T;const{LoggedIn:t,Account:o}=d.useContext(j),l=U(V.PhoneNumber),[p,v]=o,[M,r]=t,[E,A]=d.useState("notLoggedIn"),[f,h]=d.useState(0),[u,b]=d.useState({});d.useEffect(()=>{ie("Tinder")&&(E=="notLoggedIn"?V.Styles.TextColor.set("#ffffff"):V.Styles.TextColor.set("#000000"))},[E]);const[i,y]=d.useState({name:null,photos:[],_dob:{day:"",month:"",year:""},dob:null,bio:null,showMen:!1,showWomen:!1,isMale:null,active:!0}),P=g=>{var n,c,S;switch(g){case 0:let N=new Date(`${(n=i._dob)==null?void 0:n.year}/${(c=i._dob)==null?void 0:c.month}/${(S=i._dob)==null?void 0:S.day}`);if(w(N)){let R=Z(N);i.name&&i.name.length>=2&&R>=18&&R<=100&&(y({...i,dob:N.getTime()}),h(g+1))}break;case 1:i.photos.length>0&&h(g+1);break;case 2:i.bio&&i.bio.length>=10&&h(g+1);break;case 3:(i.showMen||i.showWomen)&&h(g+1);break;case 4:(i.isMale==!0||i.isMale==!1)&&D("Tinder",{action:"createAccount",data:{...i,dob:new Date(i.dob).toISOString().split("T")[0]}},!0).then(R=>{if(!R)return K("error","Failed to create account");Y.APPS.TINDER.account.set(i),v(i),r(!0)});break}},w=g=>g.getTime()===g.getTime();let s=[m("APPS.TINDER.CREATE_ACCOUNT"),m("APPS.TINDER.ADD_PHOTOS"),m("APPS.TINDER.DESCRIPTION"),m("APPS.TINDER.SHOW_ME"),m("APPS.TINDER.I_AM")];return e("div",{className:"login-container",style:{background:E==="notLoggedIn"?"linear-gradient(45deg, #ff4573, #ff5f65)":"#ffffff"},children:E==="notLoggedIn"?a(G,{children:[a("div",{className:"logo",children:[e("img",{src:"./assets/img/icons/tinder/logo-white.svg"}),e("div",{className:"logo-text",children:(T=m("APPS.TINDER.TITLE"))==null?void 0:T.toLowerCase()})]}),a("div",{className:"buttons",children:[e("div",{className:"disclamer",children:m("APPS.TINDER.AGREE_TERMS")}),e("div",{className:"button create",onClick:()=>A("createAccount"),children:m("APPS.TINDER.CREATE_ACCOUNT")})]})]}):a("div",{className:"create-account",children:[a("div",{className:"login-header",children:[e(He,{onClick:()=>{f>0?h(f-1):A("notLoggedIn")}}),e("div",{className:"title",children:s[f]})]}),f==0&&e(G,{children:a("div",{className:"form-body",children:[e($,{defaultValue:$e(l),type:"text",disabled:!0}),e($,{placeholder:"Name",type:"text",maxLength:25,onChange:g=>{y({...i,name:g.target.value}),g.target.value.length>=3?b({...u,name:!0}):b({...u,name:!1})}}),a("div",{className:"dob",children:[a("div",{className:"inputs",children:[e($,{placeholder:"MM",type:"text",pattern:"/^-?\\d+\\.?\\d*$/",minLength:2,maxLength:2,onChange:g=>{y({...i,_dob:{...i._dob,month:g.target.value}})}}),e("span",{children:"/"}),e($,{placeholder:"DD",type:"text",pattern:"/^-?\\d+\\.?\\d*$/",minLength:2,maxLength:2,onChange:g=>{y({...i,_dob:{...i._dob,day:g.target.value}})}}),e("span",{children:"/"}),e($,{placeholder:"YYYY",type:"text",pattern:"/^-?\\d+\\.?\\d*$/",minLength:4,maxLength:4,onChange:g=>{var N,R,k;let n={...i,_dob:{...i._dob,year:g.target.value}};y(n);let c=new Date(`${(N=n._dob)==null?void 0:N.year}/${(R=n._dob)==null?void 0:R.month}/${(k=n._dob)==null?void 0:k.day}`),S=Z(c);S>=18&&S<100?b({...u,18:!0}):b({...u,18:!1})}})]}),e("div",{className:"disclamer",children:m("APPS.TINDER.AGE_PUBLIC")}),a("div",{className:"requirement",children:[u[18]?e(se,{className:"green"}):e(ne,{className:"red"}),m("APPS.TINDER.BE_OVER_18")]}),a("div",{className:"requirement",children:[u.name?e(se,{className:"green"}):e(ne,{className:"red"}),m("APPS.TINDER.NAME_MINIMUM")]})]})]})}),f==1&&a(G,{children:[e("div",{className:"photo-grid",children:[...Array(6)].map((g,n)=>{var S;let c=((S=i.photos)==null?void 0:S[n-1])||n==0;return i.photos[n]?e("div",{className:"photo",style:{backgroundImage:`url(${i.photos[n]})`},children:e("div",{className:"button remove",onClick:()=>{let N=i.photos;N.splice(n,1),y({...i,photos:N}),N.length==0&&b({...u,photos:!1})},children:e(ee,{})})}):e("div",{className:"photo",children:c&&e("div",{className:"button add",onClick:()=>{var N,R,k;O.Gallery.set({allowExternal:(k=(R=(N=ae)==null?void 0:N.value)==null?void 0:R.AllowExternal)==null?void 0:k.Spark,onSelect:H=>y({...i,photos:[...i.photos,H.src]})}),b({...u,photos:!0})},children:e(Re,{})})})})}),a("div",{className:"requirement",children:[u.photos?e(se,{className:"green"}):e(ne,{className:"red"}),m("APPS.TINDER.PHOTOS_MINIMUM")]})]}),f==2&&a(G,{children:[e(ke,{placeholder:"Description",maxLength:200,onChange:g=>{y({...i,bio:g.target.value}),g.target.value.length>=10?b({...u,bio:!0}):b({...u,bio:!1})}}),a("div",{className:"requirement",children:[u.bio?e(se,{className:"green"}):e(ne,{className:"red"}),m("APPS.TINDER.DESCRIPTION_MINIMUM")]})]}),f==3&&e(G,{children:a("div",{className:"showme",children:[e("div",{className:`button border ${i.showWomen&&!i.showMen?"active":""}`,onClick:()=>{y({...i,showMen:!1,showWomen:!0})},children:m("APPS.TINDER.WOMEN")}),e("div",{className:`button border ${i.showMen&&!i.showWomen?"active":""}`,onClick:()=>{y({...i,showMen:!0,showWomen:!1})},children:m("APPS.TINDER.MEN")}),e("div",{className:`button border ${i.showMen&&i.showWomen?"active":""}`,onClick:()=>{y({...i,showMen:!0,showWomen:!0})},children:m("APPS.TINDER.EVERYONE")})]})}),f==4&&e(G,{children:a("div",{className:"showme",children:[e("div",{className:`button border ${i.isMale===!0?"active":""}`,onClick:()=>{y({...i,isMale:!0})},children:m("APPS.TINDER.MALE")}),e("div",{className:`button border ${i.isMale===!1?"active":""}`,onClick:()=>{y({...i,isMale:!1})},children:m("APPS.TINDER.FEMALE")})]})}),e("div",{className:"button gradient",onClick:()=>P(f),children:m("APPS.TINDER.CONTINUE")})]})})}const re=We(null);function ot(){var g;const{View:t,User:o}=d.useContext(j);U(V.Settings);const l=U(V.PhoneNumber),p=U(je),[v,M]=o,[r,E]=t,A=U(re),[f,h]=d.useState([]),u=d.useRef(!1),b=d.useRef(null),i=d.useRef(0),y=U(O.Emoji),[P,w]=d.useState({content:"",attachments:[]});d.useEffect(()=>{ie("Tinder")&&(v!=null&&v.unread&&(u.current=!0),D("Tinder",{action:"getMessages",number:v.number},W.messages[v.number]).then(n=>{n&&n.length>0&&h(n.reverse())}))},[]),d.useEffect(()=>{var n;if(((n=p==null?void 0:p.active)==null?void 0:n.name)==="Tinder")return()=>{u.current&&D("Tinder",{action:"markAsRead",number:v.number})}},[p==null?void 0:p.active]);const s=()=>{if(P.content.length===0&&P.attachments.length===0)return;const n={sender:l,recipient:v.number,content:P.content,attachments:P.attachments,timestamp:new Date().getTime()};D("Tinder",{action:"sendMessage",data:n},!0).then(c=>{if(!c)return K("error","Failed to send message");b.current.value="",w({content:"",attachments:[]}),h([...f,{...n,id:c}])})},{handleScroll:T}=he({fetchData:()=>{var n;return D("Tinder",{action:"getMessages",number:v.number,lastId:(n=f[f.length-1])==null?void 0:n.id})},onDataFetched:n=>{let c=document.querySelector(".message-container");i.current=c.scrollHeight,h([...n.reverse(),...f])},isReversed:!0,perPage:25});return d.useEffect(()=>{let n=document.querySelector(".message-container");const c=n.scrollHeight;n.scrollTop+=c-i.current,n.scroll},[f]),Ce("tinder:newMessage",n=>{v.number===n.sender&&(h([...f,n]),u.current=!0)}),a("div",{className:"home-wrapper slide left",children:[e(Me,{children:A&&e(rt,{})}),a("div",{className:"message-header",children:[e(Be,{onClick:()=>{E("messageList"),M(null)}}),a("div",{className:"user",onClick:()=>re.set(v),children:[e(z,{className:"profile-picture",src:(g=v.photos)==null?void 0:g[0]}),e("div",{className:"name",children:v.name})]})]}),e("div",{className:"message-container",onScroll:T,children:e("div",{className:"message-body",children:f.map((n,c)=>{var k,H,X,q;let S,N=n.sender===l?"self":"other",R=((k=f[c+1])==null?void 0:k.sender)===l?"self":"other";return f[c+1]?S=Math.abs(n.timestamp-f[c+1].timestamp)/36e5:R=void 0,a("div",{className:De("message",N),children:[N=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${N!==R?"show":"hide"}`,children:e(z,{src:(H=v.photos)==null?void 0:H[0]})}),a("div",{className:"message-content",children:[n.content&&e("div",{className:"content",children:Ie(n.content)}),((X=n.attachments)==null?void 0:X.length)>0&&e("div",{className:"attatchments",children:n.attachments.map((x,B)=>ce(x)?e("video",{src:x,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:Ne=>{O.FullscreenImage.set(x)}},B):e(z,{src:x,blur:!0,onClick:()=>{O.FullscreenImage.set(x)}},B))})]})]}):a(G,{children:[n.content&&e("div",{className:"content",children:Ie(n.content)}),((q=n.attachments)==null?void 0:q.length)>0&&e("div",{className:"attatchments",children:n.attachments.map((x,B)=>ce(x)?e("video",{src:x,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:()=>{O.FullscreenImage.set(x)}},B):e(z,{src:x,onClick:()=>{O.FullscreenImage.set(x)}},B))})]}),f[c+1]&&S>6?e("div",{className:"date",children:Se(n.timestamp)}):N!==R&&e("div",{className:"date",children:Se(n.timestamp)})]},n.id)})})}),e("div",{className:"attachments",children:P.attachments.map((n,c)=>a("div",{className:"attachment",children:[ce(n)?e("video",{src:n,controls:!1,muted:!0,loop:!0,autoPlay:!0}):e(z,{src:n}),e(ee,{onClick:()=>{w({...P,attachments:P.attachments.filter((S,N)=>N!==c)})}})]}))}),a("div",{className:"message-bottom",children:[e(Ge,{className:"image",onClick:()=>{var n,c,S;P.attachments.length<3&&O.Gallery.set({includeVideos:!0,allowExternal:(S=(c=(n=ae)==null?void 0:n.value)==null?void 0:c.AllowExternal)==null?void 0:S.Messages,onSelect:N=>w({...P,attachments:[...P.attachments,N.src]})})}}),e("div",{className:"image",onClick:()=>{if(y)return O.Emoji.reset();O.Emoji.set({onSelect:n=>w(c=>({content:`${c.content}${n.emoji}`,attachments:c.attachments}))})},children:"ðŸ˜€"}),a("div",{className:"input",children:[e($,{type:"text",placeholder:m("APPS.TINDER.TYPE_A_MESSAGE"),ref:b,value:P.content,onChange:n=>{w({...P,content:n.target.value})},onKeyDown:n=>{n.key==="Enter"&&s()}}),e(Ye,{className:P.attachments.length>0||P.content.length>0?"active":"",onClick:()=>s()})]})]})]})}const rt=()=>{var p;const t=U(re),[o,l]=d.useState(0);return t?a(Ae.div,{initial:{opacity:0,y:500},animate:{opacity:1,y:0},exit:{opacity:0,y:500},className:"popup-profile-container",children:[a("div",{className:"gallery",children:[e(z,{src:(p=t==null?void 0:t.photos)==null?void 0:p[o],onClick:()=>{t&&l(o<(t==null?void 0:t.photos.length)-1?o+1:0)}}),(t==null?void 0:t.photos.length)>1&&e("div",{className:"image-count",children:t==null?void 0:t.photos.map((v,M)=>e("div",{className:De("image",M==o&&"active"),onClick:r=>{r.stopPropagation(),l(M)}}))}),e("div",{className:"close",onClick:()=>re.set(null),children:e(ee,{})})]}),a("div",{className:"card-content",children:[a("div",{className:"name",children:[t==null?void 0:t.name,", ",e("span",{children:Z(t==null?void 0:t.dob)})]}),e("div",{className:"divider"}),a("div",{className:"description",children:[e("div",{className:"title",children:m("APPS.TINDER.ABOUT_ME")}),t==null?void 0:t.bio]})]})]}):null};function it(){const{View:t,User:o}=d.useContext(j),l=U(V.PhoneNumber),[p,v]=o,[M,r]=t,[E,A]=d.useState([]),[f,h]=d.useState([]),[u,b]=d.useState(0),i=d.useRef([]),y=d.useRef([]);d.useState(""),d.useEffect(()=>{i.current=E},[E]),d.useEffect(()=>{y.current=f},[f]),d.useEffect(()=>{ie("Tinder")&&(V.Styles.TextColor.set("#000000"),D("Tinder",{action:"getMatches"},W.accounts.filter(s=>s.matched&&!W.messages[s.number])).then(s=>{if(!s)return K("warning","No response received from Tinder getMatches");A(s)}),D("Tinder",{action:"getRecentMessages"},W.accounts.filter(s=>W.messages[s.number])).then(s=>{if(!s)return K("warning","No response received from Tinder getRecentMessages");h(s)}),D("Tinder",{action:"getNewMatchesCount"}).then(s=>{if(s===void 0)return K("warning","No response received from Tinder getNewMatchesCount");b(s)}))},[]),Ce("tinder:newMessage",s=>{if(s.sender===V.PhoneNumber.value)return;const T=y.current,g=i.current,n=T.findIndex(S=>S.lastSender===s.sender),c=g.findIndex(S=>S.lastSender===s.sender);if(n!==-1)h(S=>{const N=[...S];return N[n]={...N[n],lastMessage:s.content,lastSender:s.sender,timestamp:s.timestamp,unread:!0},N});else if(c!==-1){const S=g[c],N=g.filter((k,H)=>H!==c),R={...S,lastMessage:s.content,lastSender:s.sender,timestamp:s.timestamp,unread:!0};A(N),h(k=>[R,...k])}else{const S={name:"",number:s.sender,photos:[],dob:0,bio:"",lastMessage:s.content,lastSender:s.sender,timestamp:s.timestamp,unread:!0};h(N=>[S,...N])}});const{handleScroll:P}=he({fetchData:async s=>await D("Tinder",{action:"getMatches",page:s})||[],onDataFetched:s=>{A(T=>[...T,...s])},perPage:25,direction:"horizontal"}),{handleScroll:w}=he({fetchData:s=>D("Tinder",{action:"getRecentMessages",page:s}),onDataFetched:s=>h(T=>[...T,...s]),perPage:25});return a("div",{className:"home-wrapper slide left",children:[e(ve,{}),a("div",{className:"message-list-body",onScroll:w,children:[a("div",{className:"new-matches",children:[a("div",{className:"title",children:[m("APPS.TINDER.NEW_MATCHES"),u>0&&e("span",{children:u})]}),e("div",{className:"matches",onScroll:s=>{s.stopPropagation(),P(s)},children:E.map((s,T)=>{var g;return a("div",{className:"new-match",onClick:()=>{v({number:s.number,name:s.name,photos:s.photos,dob:s.dob,unread:s.unread,bio:s.bio,isMale:s.isMale}),r("message")},children:[e(ge,{className:"profile-picture",avatar:(g=s.photos)==null?void 0:g[0]}),e("div",{className:"name",children:s.name})]},T)})})]}),a("div",{className:"recent-messages",children:[e("div",{className:"title",children:m("APPS.TINDER.MESSAGES")}),e("div",{className:"messages",children:f.map((s,T)=>{var n,c;((n=s.lastMessage)==null?void 0:n.length)===0&&(s.lastMessage=m("APPS.MESSAGES.SENT_A_PHOTO"));let g=s.lastSender===l;return a("div",{className:"message","data-selfsender":g,onClick:()=>{v({number:s.number,name:s.name,photos:s.photos,dob:s.dob,unread:s.unread,bio:s.bio,isMale:s.isMale}),r("message")},children:[a("div",{className:"avatar",children:[e(ge,{className:"profile-picture",avatar:(c=s.photos)==null?void 0:c[0]}),s.unread&&!g&&e("div",{className:"unread"})]}),a("div",{className:"user",children:[e("div",{className:"name",children:s.name}),a("div",{className:"message-content",children:[g&&e(ze,{}),s.lastMessage.length>40?s.lastMessage.substring(0,40)+"...":s.lastMessage]})]})]},T)})})]})]})]})}function ct(){var A,f;const{Account:t,LoggedIn:o}=d.useContext(j),[l,p]=o,[v,M]=t,[r,E]=d.useState(v);return a("div",{className:"home-wrapper slide right",style:{backgroundColor:"#F6F6F6"},children:[e(ve,{}),a("div",{className:"profile-body",children:[a("div",{className:"user",children:[e(ge,{className:"profile-picture",avatar:r.photos[0]}),a("div",{className:"name",children:[r.name,", ",Z(r.dob)]})]}),a("div",{className:"inputs",children:[a("div",{className:"input",children:[e("div",{className:"label",children:m("APPS.TINDER.NAME")}),e($,{type:"text",defaultValue:r.name,maxLength:25,onChange:h=>{E({...r,name:h.target.value})}})]}),a("div",{className:"input center",children:[e("div",{className:"label",children:m("APPS.TINDER.PHOTOS")}),e("div",{className:"photo-grid",children:[...Array(6)].map((h,u)=>{var i;let b=((i=r.photos)==null?void 0:i[u-1])||u==0;return r.photos[u]?e("div",{className:"photo",style:{backgroundImage:`url(${r.photos[u]})`},children:e("div",{className:"photo-button remove",onClick:()=>{let y=r.photos;y.splice(u,1),E({...r,photos:y})},children:e(ee,{})})},u):e("div",{className:"photo",children:b&&e("div",{className:"photo-button add",onClick:()=>{var y,P,w;O.Gallery.set({allowExternal:(w=(P=(y=ae)==null?void 0:y.value)==null?void 0:P.AllowExternal)==null?void 0:w.Spark,onSelect:s=>E({...r,photos:[...r.photos,s.src]})})},children:e(Re,{})})})})})]}),a("div",{className:"input",children:[e("div",{className:"label",children:m("APPS.TINDER.ABOUT_ME")}),e(ke,{type:"text",defaultValue:r.bio,maxLength:100,onChange:h=>{E({...r,bio:h.target.value})}})]}),a("div",{className:"input",children:[e("div",{className:"label",children:m("APPS.TINDER.INTERESTED_IN")}),a("select",{value:r.showMen&&r.showWomen?"Everyone":r.showMen?"Men":"Women",onChange:h=>{switch(h.target.value){case"Everyone":E({...r,showMen:!0,showWomen:!0});break;case"Men":E({...r,showMen:!0,showWomen:!1});break;case"Women":E({...r,showMen:!1,showWomen:!0});break}},children:[e("option",{value:"Men",children:m("APPS.TINDER.MEN")}),e("option",{value:"Women",children:m("APPS.TINDER.WOMEN")}),e("option",{value:"Everyone",children:m("APPS.TINDER.EVERYONE")})]})]}),a("div",{className:"input",children:[e("div",{className:"label",children:m("APPS.TINDER.GENDER")}),a("select",{value:r.isMale?"male":"female",onChange:h=>{h.target.value=="male"?E({...r,isMale:!0}):E({...r,isMale:!1})},children:[e("option",{value:"male",children:m("APPS.TINDER.MALE")}),e("option",{value:"female",children:m("APPS.TINDER.FEMALE")})]})]}),a("div",{className:"input",children:[e("div",{className:"label",children:m("APPS.TINDER.VISIBILITY")}),a("select",{value:r.active?"visible":"hidden",onChange:h=>{let u=h.target.value;E({...r,active:u==="visible"})},children:[e("option",{value:"visible",children:m("APPS.TINDER.VISIBLE")}),e("option",{value:"hidden",children:m("APPS.TINDER.HIDDEN")})]}),!r.active&&e("div",{className:"warning",children:m("APPS.TINDER.HIDDEN_WARNING")})]})]}),((f=(A=ae)==null?void 0:A.value)==null?void 0:f.DeleteAccount.Spark)&&e("div",{className:"button red",onClick:()=>{Ke("Tinder",()=>{M(null),p(!1)},!0)},children:m("APPS.TINDER.DELETE_ACCOUNT")}),e("div",{className:"button gradient",onClick:()=>{if(r.name.length>=2&&r.bio.length>=5&&r.photos.length>=1)D("Tinder",{action:"saveProfile",data:r},!0).then(h=>{if(!h)return K("error","Issue saving Spark profile");Y.APPS.TINDER.account.set(r),M(r)});else{let h="";switch(!0){case r.name.length<2:h=m("APPS.TINDER.ERROR.SHORT_NAME");break;case r.bio.length<5:h=m("APPS.TINDER.ERROR.SHORT_BIO");break;case r.photos.length<1:h=m("APPS.TINDER.ERROR.NO_PHOTOS");break}O.PopUp.set({title:m("APPS.TINDER.ERROR.TITLE"),description:h,buttons:[{title:m("APPS.TINDER.ERROR.OK")}]})}},children:m("APPS.TINDER.SAVE")})]})]})}const j=d.createContext(null);function ut(){U(V.Settings);const[t,o]=d.useState(!1),[l,p]=d.useState(null),[v,M]=d.useState(null),[r,E]=d.useState("home"),[A,f]=d.useState(!0),h={home:e(st,{}),profile:e(ct,{}),messageList:e(it,{}),message:e(ot,{})};return d.useEffect(()=>{if(Y.APPS.TINDER.account.value){p(Y.APPS.TINDER.account.value),o(!0),f(!1);return}else if(Y.APPS.TINDER.account.value===!1)return f(!1);D("Tinder",{action:"isLoggedIn"},W.account).then(u=>{u?(p(u),o(!0),Y.APPS.TINDER.account.set(u)):Y.APPS.TINDER.account.set(!1),f(!1)})},[]),d.useEffect(()=>(r==="message"?le.ReceiveAppNotifications.set(!1):le.ReceiveAppNotifications.set(!0),()=>{le.ReceiveAppNotifications.set(!0)}),[r]),e("div",{className:"tinder-container",children:e(j.Provider,{value:{LoggedIn:[t,o],Account:[l,p],User:[v,M],View:[r,E]},children:A||!Xe()?e("div",{className:"loading",children:e(qe,{size:40,lineWeight:5,speed:2,color:"#000000"})}):t?h[r]:e(at,{})})})}function Z(t){var o=+new Date(t);return~~((Date.now()-o)/315576e5)}export{j as TinderContext,ut as default,Z as getAge};
